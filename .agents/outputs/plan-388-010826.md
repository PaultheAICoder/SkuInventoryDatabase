# Quick Fix Plan

**Issue**: #388 - [Cleanup] Remove deferred Shopify code before integration work
**Tier**: 1 (Quick Fix)
**Type**: Chore/Cleanup
**Est. Time**: 15-30 minutes
**Generated**: 2026-01-08
**Generated By**: Scout-and-Plan Agent (combined workflow)

## The Fix

Remove the obsolete `src/_deferred/shopify/` directory containing legacy Shopify code that was previously deferred to V2. This code is now completely superseded by the active Shopify integration implemented in Issues #363-364. The deferred code is excluded from TypeScript compilation (tsconfig.json) and has no imports from the active codebase. Since the `shopify/` subdirectory is the only content in `_deferred/`, the entire `_deferred/` directory should be removed along with its README.md.

## Investigation Summary

### Current State Assessment

**Deferred Directory Structure** (`src/_deferred/`):
- `README.md` - 660 bytes, explains V2 deferral
- `shopify/` - 37 files, ~380KB total

**Contents of `src/_deferred/shopify/`**:
| Type | Count | Location |
|------|-------|----------|
| Services | 3 | `services/` |
| Types | 6 | `types/` |
| Components | 6 | `components/` |
| API Routes | 13 | `api/` |
| Pages | 4 | `pages/` |
| Tests | 2 | `tests/` |
| READMEs | 2 | root + api/ |
| **Total** | **37** | |

### Active vs Deferred Comparison

The active codebase now has **complete Shopify integration** (Issues #363, #364 closed):

| Category | Deferred Location | Active Location | Status |
|----------|-------------------|-----------------|--------|
| Services | `_deferred/shopify/services/` | `src/services/shopify.ts`, `src/services/shopify-sync.ts`, `src/services/order-posting.ts`, `src/services/shopify/` | **Superseded** |
| Types | `_deferred/shopify/types/` | `src/types/shopify*.ts`, `src/types/order-posting.ts`, `src/types/channel-mapping.ts` | **Superseded** |
| Components | `_deferred/shopify/components/` | `src/components/features/` (Shopify*, Order*, Mapping*, Line*) | **Superseded** |
| API Routes | `_deferred/shopify/api/shopify/` | `src/app/api/shopify/`, `src/app/api/integrations/shopify/` | **Superseded** |
| Pages | `_deferred/shopify/pages/` | `src/app/(dashboard)/shopify/orders/`, `src/app/(dashboard)/shopify/mappings/` | **Superseded** |

**Key Findings**:
1. Services - Deferred files are identical to active counterparts (byte-for-byte match for `shopify.ts`, `shopify-sync.ts`, `order-posting.ts`)
2. Types - Active `shopify.ts` has **additional** OAuth types not in deferred version (active is more complete)
3. Components - Active versions exist in `src/components/features/` with same or updated functionality
4. API Routes - Full active implementation exists at `src/app/api/shopify/` and `src/app/api/integrations/shopify/`
5. Pages - Active pages at `src/app/(dashboard)/shopify/` with orders and mappings

### Build Verification

- Current build: **PASSES**
- TypeScript excludes `src/_deferred` via `tsconfig.json` line 25: `"exclude": ["node_modules", "src/_deferred"]`
- No imports from `_deferred` found in active codebase (grep confirmed)
- No references to `_deferred` in tests directory

### Useful Patterns to Preserve

**None** - All patterns in deferred code have been preserved in active implementations:
- Order posting flow: Active in `src/services/order-posting.ts`
- SKU aggregation logic: Active in `src/services/order-posting.ts`
- BOM version effective date lookup: Active in `src/services/order-posting.ts`
- Shopify API client patterns: Active in `src/services/shopify/client.ts`
- OAuth flow: Active in `src/services/shopify/oauth-state.ts`

## Task Classification

**Category**: CHORE
**Test Strategy**: FAST_PATH (smoke tests only - no functional changes)

## Changes Required

| File/Directory | Change | Notes |
|----------------|--------|-------|
| `src/_deferred/` | **DELETE** entire directory | Contains only shopify/ and README.md |
| `tsconfig.json` | **UPDATE** exclude array | Remove `src/_deferred` from exclude list |

### Subtask 1: Remove deferred directory

**Action**: Delete entire `src/_deferred/` directory

```bash
rm -rf /home/pbrown/SkuInventory/src/_deferred
```

**Files Removed** (37 total):
- `src/_deferred/README.md`
- `src/_deferred/shopify/README.md`
- `src/_deferred/shopify/api/README.md`
- `src/_deferred/shopify/services/order-posting.ts`
- `src/_deferred/shopify/services/shopify-sync.ts`
- `src/_deferred/shopify/services/shopify.ts`
- `src/_deferred/shopify/types/channel-mapping.ts`
- `src/_deferred/shopify/types/order-posting.ts`
- `src/_deferred/shopify/types/order-review.ts`
- `src/_deferred/shopify/types/shopify-connection.ts`
- `src/_deferred/shopify/types/shopify-sync.ts`
- `src/_deferred/shopify/types/shopify.ts`
- `src/_deferred/shopify/components/LineMappingDialog.tsx`
- `src/_deferred/shopify/components/OrderDetail.tsx`
- `src/_deferred/shopify/components/OrderReviewTable.tsx`
- `src/_deferred/shopify/components/ShopifyConnectionForm.tsx`
- `src/_deferred/shopify/components/SkuMappingForm.tsx`
- `src/_deferred/shopify/components/SkuMappingTable.tsx`
- `src/_deferred/shopify/api/shopify/connection/route.ts`
- `src/_deferred/shopify/api/shopify/connection/test/route.ts`
- `src/_deferred/shopify/api/shopify/mappings/route.ts`
- `src/_deferred/shopify/api/shopify/mappings/[id]/route.ts`
- `src/_deferred/shopify/api/shopify/mappings/import/route.ts`
- `src/_deferred/shopify/api/shopify/orders/route.ts`
- `src/_deferred/shopify/api/shopify/orders/[id]/route.ts`
- `src/_deferred/shopify/api/shopify/orders/[id]/approve/route.ts`
- `src/_deferred/shopify/api/shopify/orders/[id]/lines/[lineId]/route.ts`
- `src/_deferred/shopify/api/shopify/orders/[id]/post/route.ts`
- `src/_deferred/shopify/api/shopify/orders/[id]/skip/route.ts`
- `src/_deferred/shopify/api/shopify/orders/post-batch/route.ts`
- `src/_deferred/shopify/api/shopify/sync/route.ts`
- `src/_deferred/shopify/pages/orders/page.tsx`
- `src/_deferred/shopify/pages/orders/[id]/page.tsx`
- `src/_deferred/shopify/pages/settings/shopify/page.tsx`
- `src/_deferred/shopify/pages/settings/mappings/page.tsx`
- `src/_deferred/shopify/tests/shopify-client.test.ts`
- `src/_deferred/shopify/tests/shopify-sync.test.ts`

### Subtask 2: Update tsconfig.json

**File**: `/home/pbrown/SkuInventory/tsconfig.json`
**Line**: 25
**Change**: Remove `"src/_deferred"` from exclude array

**Before**:
```json
"exclude": ["node_modules", "src/_deferred"]
```

**After**:
```json
"exclude": ["node_modules"]
```

**Rationale**: The exclude entry is no longer needed once the directory is removed.

## Validation

```bash
# 1. Verify directory removed
ls -la /home/pbrown/SkuInventory/src/_deferred 2>&1 | grep -q "No such file" && echo "PASS: Directory removed"

# 2. TypeScript compilation
npx tsc --noEmit

# 3. Build verification
npm run build

# 4. Lint check
npm run lint

# 5. Verify no dangling references
grep -r "_deferred" --include="*.ts" --include="*.tsx" --include="*.json" /home/pbrown/SkuInventory/src/ /home/pbrown/SkuInventory/tsconfig.json
```

## Completion Criteria

- [ ] `src/_deferred/` directory completely removed (37 files)
- [ ] `tsconfig.json` exclude array updated
- [ ] `npm run build` passes
- [ ] `npx tsc --noEmit` passes
- [ ] No remaining references to `_deferred` in codebase
- [ ] Clean starting point for future Shopify work confirmed

## Files Summary

**Deleted**: 37 files (1 directory tree)
- `src/_deferred/` - entire directory

**Modified**: 1 file
- `tsconfig.json` - remove exclude entry

## Risk Assessment

**Risk**: Low
- Code is excluded from compilation, so removal has no functional impact
- Active Shopify integration is complete and working (Issues #363, #364 closed)
- No imports or references from active codebase
- Build already passes with directory present, will continue to pass after removal
