# Implementation Plan
**Generated**: 2025-12-04T12:04:25Z
**Generated By**: Scout-and-Plan Agent (combined workflow)
**Task ID**: GitHub Issue #75
**Estimated Build Time**: 0 hours (Obsolete - No implementation required)
**Complexity**: N/A - Issue Obsolete

## Investigation Summary

### Request Analysis
**Type**: Enhancement (Database Schema + Types)
**Source**: GitHub Issue #75 - [Parent #14] Add SkuInventoryBalance table and finished goods type definitions
**Priority**: Low (Obsolete)

### Task Classification
**Category**: OBSOLETE (Superseded by Issue #72)
**Test Strategy**: N/A
**Suggested Filter**: N/A

### Issue Validation
**Status**: OBSOLETE - Work completed via different approach
**Recent Changes**:
- Commit `1bc6c25` feat(issue #72): add finished goods inventory tracking from builds
- This commit implemented finished goods tracking using `FinishedGoodsLine` model instead of the `SkuInventoryBalance` table proposed in issue #75

---

## CRITICAL FINDING: Issue #75 is Obsolete

### Summary
Issue #75 proposes adding a `SkuInventoryBalance` table for explicit balance tracking of finished goods. However, this functionality has already been implemented via **Issue #72** using a different architectural approach:

| Aspect | Issue #75 Proposal | Issue #72 Implementation |
|--------|-------------------|-------------------------|
| **Model** | `SkuInventoryBalance` (explicit balance) | `FinishedGoodsLine` (transaction aggregation) |
| **Architecture** | Single balance record per SKU | Sum of transaction lines per SKU/location |
| **Updates** | Atomic balance updates | Create new line records |
| **Status** | NOT implemented | COMPLETED (2025-12-04) |

### Current Implementation (from Issue #72)

**Prisma Schema** (`prisma/schema.prisma`):
```prisma
model FinishedGoodsLine {
  id             String      @id @default(uuid())
  transactionId  String
  transaction    Transaction @relation("FinishedGoodsLines", fields: [transactionId], references: [id], onDelete: Cascade)
  skuId          String
  sku            SKU         @relation("FinishedGoodsLines", fields: [skuId], references: [id])
  quantityChange Decimal     @db.Decimal(10, 4)
  costPerUnit    Decimal?    @db.Decimal(10, 4)
  locationId     String
  location       Location    @relation("FinishedGoodsAtLocation", fields: [locationId], references: [id])

  @@index([skuId])
  @@index([locationId])
  @@index([transactionId])
}
```

**TypeScript Types** (`src/types/finished-goods.ts`):
- `AdjustFinishedGoodsInput` - Zod schema for adjustments
- `TransferFinishedGoodsInput` - Zod schema for transfers
- `SkuInventoryByLocation` - Interface for per-location inventory
- `SkuInventorySummary` - Interface for total inventory with breakdown
- `FinishedGoodsLineResponse` - Interface for API responses

**Service Functions** (`src/services/finished-goods.ts`):
- `getSkuQuantity(skuId, locationId?)` - Get balance for single SKU
- `getSkuQuantities(skuIds, locationId?)` - Get balances for multiple SKUs
- `getSkuInventorySummary(skuId)` - Get inventory grouped by location
- `adjustFinishedGoods(params)` - Create adjustment transactions
- `transferFinishedGoods(params)` - Transfer between locations

**API Endpoints**:
- `GET /api/skus/[id]/inventory` - Get SKU inventory by location
- `POST /api/skus/[id]/inventory` - Create finished goods adjustment

### Issue #75 Acceptance Criteria Analysis

| Criteria | Status | Notes |
|----------|--------|-------|
| `SkuInventoryBalance` model defined | NOT NEEDED | `FinishedGoodsLine` provides same functionality |
| Migration generated and applied | DONE | `20251204024531_add_finished_goods_line` |
| TypeScript types for FG balance responses | DONE | `src/types/finished-goods.ts` |
| Schema includes proper indexes | DONE | skuId, locationId, transactionId |
| `npx tsc --noEmit` passes | DONE | Verified 2025-12-04 |
| `npm run build` passes | DONE | Verified 2025-12-04 |

### Parent Issue Status

- **Parent #14** (Finished goods/WIP inventory tracking): CLOSED
- **Parent #9** (Multi-location inventory and finished goods): Has active issues

Issue #72 (under parent #9) implemented the finished goods feature that issue #75 (under parent #14) proposed to start. The work was done, just under a different parent/sequence.

---

## Recommendation

### Primary Recommendation: Close Issue #75 as Obsolete

**Rationale**:
1. All functional requirements are met by the `FinishedGoodsLine` implementation
2. The parent issue #14 is already closed
3. TypeScript types exist and are in use
4. Build and type checks pass
5. No additional value from adding a redundant `SkuInventoryBalance` table

### Action Items

1. **Close Issue #75** with comment explaining it was superseded by #72's implementation
2. **Review remaining #14 sub-issues** for similar obsolescence:
   - Issue #79: "Extend build transactions to output finished goods" - Likely obsolete (done in #72)
   - Issue #83: "Add finished goods adjustment and receipt API endpoints" - Likely obsolete (done in #72)
   - Issue #86: "Display finished goods balances in SKU UI" - Likely obsolete (done in #72)
   - Issue #89: "Add finished goods inventory to SKU export" - May still be needed (check)

### Suggested Closing Comment for Issue #75

```markdown
## Closing as Obsolete

This issue has been superseded by the implementation in Issue #72 ([Parent #9] Phase 5: Finished goods inventory tracking from builds).

### What Was Implemented Instead
Rather than adding a `SkuInventoryBalance` table for explicit balance tracking, we implemented `FinishedGoodsLine` (transaction-based aggregation approach) which provides:

- Per-location inventory tracking via `FinishedGoodsLine` model
- TypeScript types in `src/types/finished-goods.ts`
- Service functions in `src/services/finished-goods.ts`
- API endpoints at `/api/skus/[id]/inventory`

### Why Transaction Aggregation Over Explicit Balance
The aggregation approach was chosen for:
1. **Audit trail**: Every balance change is recorded as a line item
2. **Location awareness**: Built-in support for multi-location inventory
3. **Consistency**: Matches the pattern used for component inventory (TransactionLine)
4. **Atomicity**: Transactions are atomic with their lines

All acceptance criteria for finished goods balance tracking are satisfied by the current implementation.

See: Commit `1bc6c25` feat(issue #72): add finished goods inventory tracking from builds
```

---

## Files Affected (Already Implemented)

These files were created/modified by issue #72 and satisfy issue #75's requirements:

| File | Status | Description |
|------|--------|-------------|
| `prisma/schema.prisma` | MODIFIED | FinishedGoodsLine model added |
| `prisma/migrations/20251204024531_add_finished_goods_line/migration.sql` | CREATED | Database migration |
| `src/types/finished-goods.ts` | CREATED | TypeScript types |
| `src/types/sku.ts` | MODIFIED | Extended with FG quantities |
| `src/services/finished-goods.ts` | CREATED | FG service functions |
| `src/app/api/skus/[id]/inventory/route.ts` | CREATED | FG inventory API |

---

## No Build Phase Required

Since this issue is obsolete and the work has been completed via a different issue, there is no implementation work to perform.

**Next Steps for User/Team**:
1. Review this analysis
2. Close issue #75 with the suggested comment
3. Review and potentially close related obsolete issues (#79, #83, #86)
4. Verify issue #89 (export) still requires work

---

## Performance Metrics

| Phase | Duration |
|-------|----------|
| Investigation | 8m |
| Validation | 3m |
| Planning | 2m |
| **Total** | **13m** |

---

## Handoff Notes

**No Build Agent handoff required** - This issue is obsolete and should be closed.

If the team decides they DO want to add a `SkuInventoryBalance` table (for performance reasons with high transaction volume), that would be a NEW issue requiring:
1. Discussion of whether aggregation or explicit balance is preferred
2. Migration strategy from FinishedGoodsLine aggregation to SkuInventoryBalance
3. Service changes to maintain both or migrate
4. This would be significant refactoring work (estimated 8-12 hours)

However, the current `FinishedGoodsLine` approach is working correctly and follows the same pattern as component inventory tracking.
