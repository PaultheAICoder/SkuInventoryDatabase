# Scout Report: Add Build Version Footer with Auto-increment via Pre-commit Hook

## Request Analysis
**Type**: Enhancement
**Source**: GitHub Issue #16
**Priority**: Medium

## Task Classification
**Category**: NEW_FEATURE
**Test Strategy**: FAST_PATH
**Suggested Filter**: None (no existing tests to run)

## Issue Validation
**Status**: ✅ Valid
**Recent Changes**: No recent commits affecting footer or version functionality
**Overlap Check**: No closed issues related to version/footer functionality

## Current State

### Existing Components
- ✅ Dashboard layout exists: `/home/pbrown/SkuInventory/src/app/(dashboard)/layout.tsx`
- ✅ Root layout exists: `/home/pbrown/SkuInventory/src/app/layout.tsx`
- ✅ Scripts directory exists: `/home/pbrown/SkuInventory/scripts/`
- ✅ UI components directory exists: `/home/pbrown/SkuInventory/src/components/ui/`
- ❌ No version.json file exists
- ❌ No version.ts file exists
- ❌ No husky setup exists
- ❌ No pre-commit hooks exist
- ❌ No BuildFooter component exists

### Database
**No database changes required** - This is a pure UI/build system feature.

### API Routes
**No API routes affected** - This is a static, compile-time feature.

### Types
**No new TypeScript types needed** - Will use simple string/date types from version.json.

### Build System Status
- ✅ TypeScript compiles without errors: `npx tsc --noEmit` passes
- ⚠️ Build has unrelated error in `/api/export/transactions` route (pre-existing issue)
- ✅ Project uses Next.js 14 (App Router) with static generation support

### Dependencies Check
**Current package.json** (relevant sections):
- Node version: Using Node 18+ (required for husky)
- No husky installed
- No git-hook related packages
- Scripts directory exists with 3 files: `deploy.sh`, `generate-ssl.sh`, `seed-inventory.ts`

## Dependencies & Blockers

### Required Dependencies
1. **husky** (^9.0.0) - Git hook management (install via npm)
2. **Node.js built-in modules** - `fs`, `path`, `child_process` for version script

### Files to Create
1. `/home/pbrown/SkuInventory/version.json` - Version data file (initial: 0.5.1)
2. `/home/pbrown/SkuInventory/scripts/increment-version.js` - Version increment script
3. `/home/pbrown/SkuInventory/.husky/pre-commit` - Husky pre-commit hook
4. `/home/pbrown/SkuInventory/src/components/ui/BuildFooter.tsx` - Footer component

### Files to Modify
1. `/home/pbrown/SkuInventory/src/app/(dashboard)/layout.tsx` - Add BuildFooter to layout
2. `/home/pbrown/SkuInventory/package.json` - Add husky dependency, prepare script
3. `/home/pbrown/SkuInventory/tsconfig.json` - May need to add version.json to includes

### Blockers
**None identified** - All prerequisites are met:
- ✅ Git repository exists
- ✅ Scripts directory exists
- ✅ Dashboard layout is accessible
- ✅ shadcn/ui components pattern established
- ✅ TypeScript compilation works

**Can Proceed?**: YES

## Complexity Assessment

**Complexity**: Simple
**Effort**: 2-4 hours
**Risk**: Low

### Breakdown
1. **Install husky** - 15 minutes
2. **Create version.json** - 5 minutes
3. **Create increment script** - 30 minutes
4. **Configure pre-commit hook** - 15 minutes
5. **Create BuildFooter component** - 30 minutes
6. **Integrate footer into layout** - 15 minutes
7. **Test commit hook** - 30 minutes
8. **Documentation** - 30 minutes

**Total Estimated**: 2.5 hours

### Risk Assessment
- **Low Risk**: Isolated feature, no database changes
- **No Breaking Changes**: Only adds new component
- **Rollback Easy**: Can remove hook and footer independently
- **Cross-platform Concern**: Husky works on macOS/Linux/Windows (Git Bash)

## Patterns to Follow

### Primary Pattern: shadcn/ui Component Structure
**Reference**: `/home/pbrown/SkuInventory/src/components/ui/badge.tsx`
```typescript
// Simple functional component with cn() utility for className merging
// Uses forwardRef pattern for reusable components
// Exports both component and any variants
```

**Reference**: `/home/pbrown/SkuInventory/src/components/ui/card.tsx`
```typescript
// Shows CardFooter pattern: <div className={cn('flex items-center p-6 pt-0', className)} />
// Similar styling approach can be used for BuildFooter
```

### Secondary Pattern: Layout Integration
**Reference**: `/home/pbrown/SkuInventory/src/app/(dashboard)/layout.tsx`
```typescript
// Current structure:
// - Sidebar (aside) with navigation
// - Main content area with mobile header + children
// - User info at bottom of sidebar
//
// Footer should be added after {children} in main content area
// Current line 120: <main className="p-4 lg:p-8">{children}</main>
// Should become: <main>...{children}<BuildFooter /></main>
```

### Tertiary Pattern: Deployment Scripts
**Reference**: `/home/pbrown/SkuInventory/scripts/deploy.sh`
- Shows project uses bash scripts for automation
- increment-version.js should follow Node.js script conventions
- Should use synchronous file operations for git hook compatibility

## Files to Create/Modify

### Files to Create (4 files)

#### 1. `/home/pbrown/SkuInventory/version.json`
**Purpose**: Store version number and build timestamp
**Format**: JSON
**Initial Content**:
```json
{
  "version": "0.5.1",
  "buildTimestamp": "2025-12-02T10:00:00Z"
}
```

#### 2. `/home/pbrown/SkuInventory/scripts/increment-version.js`
**Purpose**: Increment patch version and update timestamp on commit
**Format**: Node.js script
**Key Functions**:
- Read version.json
- Parse semver (split on '.')
- Increment patch number
- Update timestamp to current ISO string
- Write back to version.json
- Stage file with `git add version.json`

#### 3. `/home/pbrown/SkuInventory/.husky/pre-commit`
**Purpose**: Run version increment before each commit
**Format**: Shell script
**Content**: Call `node scripts/increment-version.js`

#### 4. `/home/pbrown/SkuInventory/src/components/ui/BuildFooter.tsx`
**Purpose**: Display version and timestamp in footer
**Format**: React component (TypeScript)
**Key Features**:
- Import version.json (will need to configure TypeScript to allow JSON imports)
- Display version number
- Format timestamp in human-readable format
- Use muted text color, small size
- Center alignment, border-top
- Match shadcn/ui styling patterns

### Files to Modify (2-3 files)

#### 1. `/home/pbrown/SkuInventory/package.json`
**Changes**:
- Add `"husky": "^9.0.0"` to devDependencies
- Add `"prepare": "husky"` to scripts section (for npm install hook setup)

#### 2. `/home/pbrown/SkuInventory/src/app/(dashboard)/layout.tsx`
**Changes** (around line 120):
- Import BuildFooter component
- Add `<BuildFooter />` after `{children}` inside main element
- May need to adjust padding/layout for footer positioning

**Current structure**:
```tsx
<main className="p-4 lg:p-8">{children}</main>
```

**Proposed structure**:
```tsx
<main className="flex flex-col min-h-screen">
  <div className="flex-1 p-4 lg:p-8">{children}</div>
  <BuildFooter />
</main>
```

#### 3. `/home/pbrown/SkuInventory/tsconfig.json` (possibly)
**Changes**:
- May need to add `"resolveJsonModule": true` to compilerOptions
- May need to add version.json to includes/exclude

## Final Sweep Results

### Services Search
**0 files found** - No service layer changes needed (pure UI feature)

### API Routes
**0 usages** - No API routes affected (static data)

### Type Definitions
**0 types affected** - No existing types need modification
**Note**: BOMVersion types exist (148 occurrences across 22 files) but are unrelated to build version

### Components Using Changed Code
**1 component** affected:
- `/home/pbrown/SkuInventory/src/app/(dashboard)/layout.tsx` - will import and render new BuildFooter

### Component Import Patterns
**41 files** import from `components/ui/` - Shows established pattern for UI components
**No changes needed** to existing imports - BuildFooter is additive

### Test Files
**0 test files** reference version/footer functionality (new feature)

### All Affected Files (Comprehensive List)

#### Files to Create (4)
1. `/home/pbrown/SkuInventory/version.json` - Version data storage
2. `/home/pbrown/SkuInventory/scripts/increment-version.js` - Auto-increment logic
3. `/home/pbrown/SkuInventory/.husky/pre-commit` - Git hook configuration
4. `/home/pbrown/SkuInventory/src/components/ui/BuildFooter.tsx` - Footer component

#### Files to Modify (3)
1. `/home/pbrown/SkuInventory/package.json` - Add husky dependency
2. `/home/pbrown/SkuInventory/src/app/(dashboard)/layout.tsx` - Integrate footer
3. `/home/pbrown/SkuInventory/tsconfig.json` - Enable JSON module resolution (if needed)

#### Files Potentially Affected by git add (during hook)
- `/home/pbrown/SkuInventory/version.json` - Will be auto-staged by pre-commit hook

**TOTAL FILES AFFECTED**: 7 files

## Ripple Effect Analysis

### Function: BuildFooter Component (NEW)
**Direct Callers**: 1 file
  - `/home/pbrown/SkuInventory/src/app/(dashboard)/layout.tsx` (will render component)

**Indirect Callers**: 0 files (leaf component, no wrapper functions)

**TOTAL FILES AFFECTED**: 1 file

### Function: increment-version.js Script (NEW)
**Direct Callers**: 1 file
  - `/home/pbrown/SkuInventory/.husky/pre-commit` (will execute script)

**Indirect Callers**: Git itself (via pre-commit hook mechanism)

**TOTAL FILES AFFECTED**: 1 file + git process

### TypeScript Module Resolution
**Impact**: version.json import in BuildFooter.tsx

**Potential Issues**:
- TypeScript may not allow JSON imports by default
- May need `resolveJsonModule: true` in tsconfig.json
- Alternative: Create `src/lib/version.ts` that exports constants

**Decision Point**: Plan Agent should decide between:
- **Option A**: JSON import (requires tsconfig change, simpler data file)
- **Option B**: TypeScript module (no config change, type-safe)

## Technical Decisions for Plan Agent

### Decision 1: Version File Format
**Recommended**: JSON (`version.json`)
**Rationale**:
- Simpler for script manipulation
- Human-readable for manual version bumps (minor/major)
- Standard format for metadata
- Issue explicitly suggests this approach

**Alternative**: TypeScript module (`src/lib/version.ts`)
**Pros**: No tsconfig changes needed, type-safe
**Cons**: Less convenient for script updates, not as human-readable

### Decision 2: Footer Placement
**Options**:
1. **Inside dashboard layout** (Recommended) - Appears on all dashboard pages
2. **Root layout** - Appears on ALL pages including login
3. **Per-page basis** - Manual integration

**Recommendation**: Option 1 - Issue states "all dashboard pages", login page doesn't need version

### Decision 3: Timestamp Format
**Options**:
1. ISO string in JSON, format on render (Recommended)
2. Human-readable string in JSON
3. Unix timestamp

**Recommendation**: Option 1 - Flexibility in display, standard format

### Decision 4: Version Increment Strategy
**Confirmed from Issue**:
- Patch auto-increments: 0.5.1 → 0.5.2 → 0.5.3
- Minor/Major: Manual edit of version.json
- Starting version: 0.5.1

## Implementation Phases (Suggested)

### Phase 1: Setup Infrastructure (30 min)
1. Install husky: `npm install husky --save-dev`
2. Initialize husky: `npx husky init`
3. Create version.json with initial 0.5.1
4. Update package.json with prepare script

### Phase 2: Create Version Script (30 min)
1. Create `scripts/increment-version.js`
2. Implement semver parsing and increment
3. Implement timestamp update
4. Add git staging of version.json
5. Add console logging for visibility

### Phase 3: Configure Pre-commit Hook (15 min)
1. Create/edit `.husky/pre-commit`
2. Add call to increment-version.js
3. Test hook with dummy commit

### Phase 4: Build Footer Component (45 min)
1. Create `src/components/ui/BuildFooter.tsx`
2. Import version.json (or create version.ts)
3. Implement display logic
4. Style with Tailwind (match existing patterns)
5. Format timestamp display

### Phase 5: Integrate Footer (30 min)
1. Update tsconfig.json if using JSON import
2. Import BuildFooter in dashboard layout
3. Adjust layout structure for footer positioning
4. Test responsive design (mobile/desktop)

### Phase 6: Testing & Verification (30 min)
1. Verify footer displays correctly on all dashboard pages
2. Make test commit, verify version increments
3. Check version.json is staged and committed
4. Verify timestamp updates
5. Test build: `npm run build`
6. Test typecheck: `npx tsc --noEmit`

## Acceptance Criteria

From Issue #16:
- [ ] Footer visible on all dashboard pages showing "Build 0.5.X"
- [ ] Timestamp shows last commit date in readable format
- [ ] Making a commit increments the patch version automatically
- [ ] Version file is committed with each change
- [ ] Works on macOS (primary dev environment)
- [ ] Build succeeds without errors or warnings
- [ ] All tests passing (no existing tests for this feature)

### Additional Verification Points
- [ ] Footer styled consistently with existing UI components
- [ ] Footer doesn't interfere with page content or scrolling
- [ ] Hook works in all git workflows (commit, commit --amend, etc.)
- [ ] Version.json maintains valid JSON format after updates
- [ ] Manual version bumps (minor/major) are documented

## Known Considerations

### 1. Pre-commit Hook Limitations
- Hooks don't run on `git push` (only local commits)
- Hooks don't run on GitHub web interface commits
- Developer must have Node.js installed
- First-time setup requires `npm install` to trigger prepare script

### 2. Version Conflicts
- Multiple developers committing simultaneously could have version conflicts
- Git will handle merge conflicts in version.json normally
- Resolution: Accept incoming version (higher number)

### 3. Build vs Commit Timestamp
**Issue states**: "commit timestamp" - Script should use commit time, not build time
**Implementation**: Use `new Date().toISOString()` at pre-commit, not at build/render time

### 4. TypeScript Configuration
- Current tsconfig.json may not allow JSON imports
- May need to enable `resolveJsonModule` and `esModuleInterop`
- Alternative: Use TypeScript file instead of JSON

### 5. Display Format
**Issue states**: "human-readable format" for timestamp
**Recommended**: `new Date(timestamp).toLocaleDateString()` or similar
**Example**: "12/2/2024" or "December 2, 2024"

## Edge Cases to Handle

1. **Invalid version.json format** - Script should validate and fail gracefully
2. **Missing version.json** - Script should create with default 0.5.1
3. **Pre-existing version.json** - Script should read and increment existing
4. **Manual version changes** - Script should respect manual edits to major/minor
5. **Hook failure** - Git commit should abort if script fails (return non-zero)

## Handoff to Plan Agent

### Summary
This is a straightforward feature requiring no database changes, no API modifications, and no complex state management. The implementation involves:
1. Setting up husky for git hook management
2. Creating a Node.js script to auto-increment semantic version numbers
3. Building a simple footer component following existing shadcn/ui patterns
4. Integrating the footer into the dashboard layout

The feature is isolated, low-risk, and provides immediate value for version tracking and bug reporting. All dependencies are available, patterns are established, and the codebase is ready for implementation.

### Key Points
1. **No blockers** - All prerequisites exist, TypeScript compiles cleanly
2. **Simple complexity** - Estimated 2.5 hours, single-developer task
3. **Clear patterns** - Follow existing shadcn/ui component structure
4. **Well-defined scope** - Issue provides clear requirements and implementation details
5. **Low risk** - Additive feature, easy rollback, no breaking changes
6. **One decision point** - JSON vs TypeScript for version file (recommend JSON)

### Suggested Implementation Order
1. Infrastructure first (husky + version.json) - Ensures foundation is solid
2. Script next (increment-version.js) - Test independently before UI work
3. Pre-commit hook configuration - Validate automation works
4. UI component last (BuildFooter) - Visual confirmation of working system
5. Integration and testing - End-to-end verification

### Red Flags / Watch-outs
- **BOMVersion confusion**: Project has extensive BOMVersion types (148 occurrences) - ensure naming clearly distinguishes "build version" from "BOM version"
- **TypeScript JSON imports**: May require tsconfig modification or alternative approach
- **Pre-existing build error**: `/api/export/transactions` has unrelated dynamic rendering error - don't introduce new build errors
- **Layout structure**: Current dashboard layout is complex with sidebar - ensure footer doesn't break responsive design

## Performance Metrics

| Phase | Duration |
|-------|----------|
| Issue Parsing | 2m |
| Codebase Exploration | 8m |
| Pattern Identification | 5m |
| Dependency Analysis | 3m |
| Final Sweep | 4m |
| Ripple Effect Analysis | 3m |
| Report Writing | 15m |
| **Total** | **40m** |

---

**Report Generated**: 2025-12-02
**Issue**: #16
**Status**: Ready for Plan Agent
**Confidence**: High (95%)
