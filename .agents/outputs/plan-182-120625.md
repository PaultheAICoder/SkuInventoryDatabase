# Implementation Plan
**Generated**: 2025-12-06T16:30:00Z
**Generated By**: Scout-and-Plan Agent (combined workflow)
**Task ID**: GitHub Issue #182
**Estimated Build Time**: 6-8 hours
**Complexity**: Moderate

## Investigation Summary

### Request Analysis
**Type**: Enhancement
**Source**: GitHub Issue #182
**Priority**: Medium (nice to have per user)

**User Request**: Click on "buildable" value to see more detail - specifically the top 3 components that are limiting factors for the max buildable quantity, ranked by which components limit buildable quantity the most.

**Example from User**: If a SKU uses 3 components:
- Component 1 has 100 units available
- Component 2 has 200 units available
- Component 3 has 50 units available

Show component 3 as the primary limit (50), followed by component 1 (100), then component 2 (200).

### Task Classification
**Category**: NEW_FEATURE
**Test Strategy**: TARGETED
**Suggested Filter**: `--filter="buildable|bom|limiting"`

### Issue Validation
**Status**: Valid
**Recent Changes**: BuildableUnitsDisplay.tsx and bom.ts have had several recent commits but none directly related to this feature

### Current State Assessment

**Existing Components**:
1. `BuildableUnitsDisplay.tsx` - Shows buildable units count with color coding (red/yellow/green)
2. `calculateMaxBuildableUnits()` in `src/services/bom.ts` - Calculates minimum buildable across all BOM lines
3. `calculateMaxBuildableUnitsForSKUs()` in `src/services/bom.ts` - Batch version of above
4. `SKUTable.tsx` - Displays buildable column in SKU list
5. `TopBuildableSkusList.tsx` - Dashboard widget showing top buildable SKUs
6. SKU Detail Page (`/skus/[id]/page.tsx`) - Shows buildable units in detail card

**Database**: No schema changes needed - all required data already accessible via BOMLine -> Component relations

**API Routes Involved**:
- `GET /api/skus/[id]` - Returns maxBuildableUnits for single SKU
- `GET /api/skus` - Returns maxBuildableUnits for SKU list
- `GET /api/dashboard` - Returns topBuildableSkus

**Types Affected**:
- `src/types/sku.ts` - SKUResponse type may need new `limitingComponents` field

### Dependencies & Blockers

1. **No Popover/Tooltip component installed** - Need to install `@radix-ui/react-popover` and create UI component
2. No blockers identified - all required data is accessible

**Can Proceed?**: YES

### Complexity Assessment
**Complexity**: Moderate
**Effort**: 6-8 hours
**Risk**: Low

### Patterns Identified

**Primary**: `src/components/features/DefectThresholdConfig.tsx` (lines 219-306)
- Uses Dialog component with DialogTrigger for click-to-open
- Pattern: Button triggers Dialog containing table/detail content

**Secondary**: `src/components/ui/dialog.tsx`
- Standard shadcn/ui dialog pattern with Radix UI

### Ripple Effect Analysis

**Files Identified**: 10 files potentially affected

**Core Changes (must modify)**:
1. `src/services/bom.ts` - Add new function to calculate limiting factors
2. `src/types/sku.ts` - Add LimitingComponent type
3. `src/components/features/BuildableUnitsDisplay.tsx` - Add click handler and dialog/popover
4. `src/app/api/skus/[id]/route.ts` - Include limiting factors in response

**Secondary Changes (display updates)**:
5. `src/components/features/SKUTable.tsx` - Update buildable cell to use enhanced display
6. `src/components/features/TopBuildableSkusList.tsx` - Update to use enhanced display
7. `src/app/(dashboard)/skus/[id]/page.tsx` - Already uses BuildableUnitsDisplay

**New Files**:
8. `src/components/ui/popover.tsx` - New shadcn/ui popover component (or use Dialog)

---

## Executive Summary

This feature adds click-to-view functionality on buildable unit counts to show the top 3 limiting components. Implementation requires:
1. A new service function to calculate limiting factors with rankings
2. Extending the BuildableUnitsDisplay component to be clickable
3. A popover/dialog showing the limiting components table
4. API updates to include limiting factor data

## Phase 0: Environment Setup

### Subtask 0.1: Install Popover Component Dependencies
**File**: N/A (npm install)
**Instructions**:
1. Install radix popover: `npm install @radix-ui/react-popover`
2. Verify installation in package.json

**Validation**:
```bash
npm install @radix-ui/react-popover
grep -q "react-popover" package.json && echo "Installed"
```

**Completion Criteria**:
- [ ] Package installed successfully
- [ ] No npm audit issues

---

## Phase 1: Types Layer

### Subtask 1.1: Add LimitingComponent Type
**File**: `/home/pbrown/SkuInventory/src/types/sku.ts`
**Pattern**: Follow existing interface definitions in same file
**Instructions**:
1. Add new interface after line 72 (after SKUResponse):

```typescript
// Limiting component for buildable units calculation
export interface LimitingComponent {
  componentId: string
  componentName: string
  skuCode: string
  quantityOnHand: number
  quantityPerUnit: number
  maxBuildable: number  // floor(quantityOnHand / quantityPerUnit)
  rank: number          // 1 = most limiting, 2 = second, etc.
}
```

2. Update SKUResponse to include optional limitingComponents:
```typescript
export interface SKUResponse {
  // ... existing fields ...
  maxBuildableUnits?: number | null
  limitingComponents?: LimitingComponent[] | null  // Add this line
  finishedGoodsQuantity?: number | null
}
```

**Validation**:
```bash
npx tsc --noEmit
```

**Completion Criteria**:
- [ ] LimitingComponent interface defined
- [ ] SKUResponse extended with limitingComponents
- [ ] TypeScript compiles without errors

---

## Phase 2: Service Layer

### Subtask 2.1: Add calculateLimitingFactors Function
**File**: `/home/pbrown/SkuInventory/src/services/bom.ts`
**Pattern**: Follow `calculateMaxBuildableUnits()` function at lines 61-101
**Instructions**:
1. Add new function after `calculateMaxBuildableUnitsForSKUs()` (after line 168):

```typescript
import type { LimitingComponent } from '@/types/sku'

/**
 * Calculate the top N limiting components for a SKU's buildable units
 * Returns components sorted by how much they limit production (ascending by maxBuildable)
 * Optionally filter by location - if locationId is omitted, uses global inventory
 */
export async function calculateLimitingFactors(
  skuId: string,
  locationId?: string,
  limit: number = 3
): Promise<LimitingComponent[] | null> {
  // Get active BOM for this SKU
  const activeBom = await prisma.bOMVersion.findFirst({
    where: {
      skuId,
      isActive: true,
    },
    include: {
      lines: {
        include: {
          component: {
            select: {
              id: true,
              name: true,
              skuCode: true,
            },
          },
        },
      },
    },
  })

  if (!activeBom || activeBom.lines.length === 0) {
    return null
  }

  // Get component quantities (filtered by location if specified)
  const componentIds = activeBom.lines.map((line) => line.component.id)
  const quantities = await getComponentQuantities(componentIds, locationId)

  // Calculate buildable for each component and collect all factors
  const factors: LimitingComponent[] = []

  for (const line of activeBom.lines) {
    const quantityOnHand = quantities.get(line.componentId) ?? 0
    const quantityPerUnit = line.quantityPerUnit.toNumber()
    const maxBuildable = Math.floor(quantityOnHand / quantityPerUnit)

    factors.push({
      componentId: line.component.id,
      componentName: line.component.name,
      skuCode: line.component.skuCode,
      quantityOnHand,
      quantityPerUnit,
      maxBuildable,
      rank: 0, // Will be assigned after sorting
    })
  }

  // Sort by maxBuildable ascending (most limiting first)
  factors.sort((a, b) => a.maxBuildable - b.maxBuildable)

  // Assign ranks and return top N
  const result = factors.slice(0, limit).map((f, index) => ({
    ...f,
    rank: index + 1,
  }))

  return result
}
```

2. Add the import for LimitingComponent at top of file

**Validation**:
```bash
npx tsc --noEmit
npm run build
```

**Completion Criteria**:
- [ ] Function implemented with correct logic
- [ ] Returns top 3 limiting components by default
- [ ] Sorted correctly (most limiting first)
- [ ] Ranks assigned correctly (1, 2, 3)
- [ ] TypeScript compiles without errors

---

## Phase 3: UI Components

### Subtask 3.1: Create Popover UI Component
**File**: `/home/pbrown/SkuInventory/src/components/ui/popover.tsx`
**Pattern**: Follow `src/components/ui/dialog.tsx` structure
**Instructions**:
1. Create new popover component following shadcn/ui pattern:

```typescript
'use client'

import * as React from 'react'
import * as PopoverPrimitive from '@radix-ui/react-popover'
import { cn } from '@/lib/utils'

const Popover = PopoverPrimitive.Root

const PopoverTrigger = PopoverPrimitive.Trigger

const PopoverAnchor = PopoverPrimitive.Anchor

const PopoverContent = React.forwardRef<
  React.ElementRef<typeof PopoverPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>
>(({ className, align = 'center', sideOffset = 4, ...props }, ref) => (
  <PopoverPrimitive.Portal>
    <PopoverPrimitive.Content
      ref={ref}
      align={align}
      sideOffset={sideOffset}
      className={cn(
        'z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2',
        className
      )}
      {...props}
    />
  </PopoverPrimitive.Portal>
))
PopoverContent.displayName = PopoverPrimitive.Content.displayName

export { Popover, PopoverTrigger, PopoverContent, PopoverAnchor }
```

**Validation**:
```bash
npx tsc --noEmit
```

**Completion Criteria**:
- [ ] Popover component created
- [ ] Exports Popover, PopoverTrigger, PopoverContent
- [ ] TypeScript compiles without errors

### Subtask 3.2: Create LimitingComponentsPopover Component
**File**: `/home/pbrown/SkuInventory/src/components/features/LimitingComponentsPopover.tsx`
**Pattern**: Follow table pattern from `CriticalComponentsList.tsx`
**Instructions**:
1. Create new component:

```typescript
'use client'

import { useState, useEffect } from 'react'
import Link from 'next/link'
import {
  Popover,
  PopoverContent,
  PopoverTrigger,
} from '@/components/ui/popover'
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table'
import { Loader2 } from 'lucide-react'
import type { LimitingComponent } from '@/types/sku'

interface LimitingComponentsPopoverProps {
  skuId: string
  maxBuildableUnits: number
  children: React.ReactNode
  locationId?: string
}

export function LimitingComponentsPopover({
  skuId,
  maxBuildableUnits,
  children,
  locationId,
}: LimitingComponentsPopoverProps) {
  const [open, setOpen] = useState(false)
  const [limitingComponents, setLimitingComponents] = useState<LimitingComponent[] | null>(null)
  const [isLoading, setIsLoading] = useState(false)
  const [error, setError] = useState<string | null>(null)

  useEffect(() => {
    if (open && !limitingComponents && !isLoading) {
      const fetchLimitingFactors = async () => {
        setIsLoading(true)
        setError(null)
        try {
          let url = `/api/skus/${skuId}/limiting-factors`
          if (locationId) {
            url += `?locationId=${locationId}`
          }
          const res = await fetch(url)
          if (!res.ok) {
            throw new Error('Failed to load limiting factors')
          }
          const data = await res.json()
          setLimitingComponents(data.data)
        } catch (err) {
          setError(err instanceof Error ? err.message : 'Failed to load')
        } finally {
          setIsLoading(false)
        }
      }
      fetchLimitingFactors()
    }
  }, [open, skuId, locationId, limitingComponents, isLoading])

  // Reset data when popover closes (optional - for fresh data on reopen)
  useEffect(() => {
    if (!open) {
      setLimitingComponents(null)
    }
  }, [open])

  return (
    <Popover open={open} onOpenChange={setOpen}>
      <PopoverTrigger asChild>
        {children}
      </PopoverTrigger>
      <PopoverContent className="w-96" align="start">
        <div className="space-y-3">
          <div>
            <h4 className="font-medium text-sm">Limiting Components</h4>
            <p className="text-xs text-muted-foreground">
              Top 3 components limiting max buildable ({maxBuildableUnits.toLocaleString()} units)
            </p>
          </div>

          {isLoading ? (
            <div className="flex items-center justify-center py-4">
              <Loader2 className="h-5 w-5 animate-spin text-muted-foreground" />
            </div>
          ) : error ? (
            <p className="text-sm text-red-500">{error}</p>
          ) : limitingComponents && limitingComponents.length > 0 ? (
            <Table>
              <TableHeader>
                <TableRow>
                  <TableHead className="text-xs">Component</TableHead>
                  <TableHead className="text-right text-xs">On Hand</TableHead>
                  <TableHead className="text-right text-xs">Per Unit</TableHead>
                  <TableHead className="text-right text-xs">Max Build</TableHead>
                </TableRow>
              </TableHeader>
              <TableBody>
                {limitingComponents.map((component) => (
                  <TableRow key={component.componentId}>
                    <TableCell className="py-2">
                      <Link
                        href={`/components/${component.componentId}`}
                        className="text-sm font-medium hover:underline"
                      >
                        {component.componentName}
                      </Link>
                      <div className="text-xs text-muted-foreground font-mono">
                        {component.skuCode}
                      </div>
                    </TableCell>
                    <TableCell className="text-right font-mono text-sm py-2" suppressHydrationWarning>
                      {component.quantityOnHand.toLocaleString()}
                    </TableCell>
                    <TableCell className="text-right font-mono text-sm py-2" suppressHydrationWarning>
                      {component.quantityPerUnit.toLocaleString()}
                    </TableCell>
                    <TableCell className="text-right py-2">
                      <span
                        className={`font-mono text-sm ${
                          component.rank === 1 ? 'text-red-600 font-semibold' : ''
                        }`}
                        suppressHydrationWarning
                      >
                        {component.maxBuildable.toLocaleString()}
                      </span>
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>
          ) : (
            <p className="text-sm text-muted-foreground">No BOM data available</p>
          )}
        </div>
      </PopoverContent>
    </Popover>
  )
}
```

**Validation**:
```bash
npx tsc --noEmit
```

**Completion Criteria**:
- [ ] Component created with proper imports
- [ ] Lazy loads data on popover open
- [ ] Shows loading state
- [ ] Shows error state
- [ ] Displays table with limiting components
- [ ] Links to component detail pages
- [ ] TypeScript compiles without errors

### Subtask 3.3: Update BuildableUnitsDisplay to be Clickable
**File**: `/home/pbrown/SkuInventory/src/components/features/BuildableUnitsDisplay.tsx`
**Pattern**: Existing component structure
**Instructions**:
1. Update the component to optionally wrap content in LimitingComponentsPopover:

```typescript
import { Package } from 'lucide-react'
import { LimitingComponentsPopover } from './LimitingComponentsPopover'

interface BuildableUnitsDisplayProps {
  maxBuildableUnits: number | null | undefined
  showLabel?: boolean
  size?: 'sm' | 'md' | 'lg'
  skuId?: string           // Add: Required for clickable version
  locationId?: string      // Add: For location-filtered queries
  clickable?: boolean      // Add: Enable click-to-show limiting factors
}

export function BuildableUnitsDisplay({
  maxBuildableUnits,
  showLabel = true,
  size = 'md',
  skuId,
  locationId,
  clickable = false,
}: BuildableUnitsDisplayProps) {
  const sizeClasses = {
    sm: 'text-sm',
    md: 'text-lg',
    lg: 'text-2xl',
  }

  if (maxBuildableUnits == null) {
    return (
      <div className="flex items-center gap-2">
        <Package className="h-4 w-4 text-muted-foreground" />
        <span className="text-muted-foreground">No BOM</span>
      </div>
    )
  }

  const isZero = maxBuildableUnits === 0
  const isLow = maxBuildableUnits > 0 && maxBuildableUnits < 10

  const content = (
    <div className={`flex items-center gap-2 ${clickable && skuId ? 'cursor-pointer hover:opacity-80' : ''}`}>
      <Package className={`h-4 w-4 ${isZero ? 'text-red-500' : isLow ? 'text-yellow-500' : 'text-green-500'}`} />
      <div>
        <span
          className={`font-mono font-medium ${sizeClasses[size]} ${
            isZero ? 'text-red-600' : isLow ? 'text-yellow-600' : ''
          }`}
          suppressHydrationWarning
        >
          {maxBuildableUnits.toLocaleString()}
        </span>
        {showLabel && (
          <span className="text-muted-foreground text-sm ml-1">
            {maxBuildableUnits === 1 ? 'unit' : 'units'}
          </span>
        )}
      </div>
    </div>
  )

  // Wrap in popover if clickable and skuId provided
  if (clickable && skuId) {
    return (
      <LimitingComponentsPopover
        skuId={skuId}
        maxBuildableUnits={maxBuildableUnits}
        locationId={locationId}
      >
        {content}
      </LimitingComponentsPopover>
    )
  }

  return content
}
```

**Validation**:
```bash
npx tsc --noEmit
```

**Completion Criteria**:
- [ ] New props added: skuId, locationId, clickable
- [ ] Wraps in popover when clickable=true and skuId provided
- [ ] Shows cursor pointer on hover when clickable
- [ ] Backward compatible (existing usages unchanged)
- [ ] TypeScript compiles without errors

---

## Phase 4: API Routes

### Subtask 4.1: Create Limiting Factors API Endpoint
**File**: `/home/pbrown/SkuInventory/src/app/api/skus/[id]/limiting-factors/route.ts`
**Pattern**: Follow `src/app/api/skus/[id]/route.ts` structure
**Instructions**:
1. Create new directory and route file:

```typescript
import { NextRequest } from 'next/server'
import { getServerSession } from 'next-auth'
import { authOptions } from '@/lib/auth'
import { prisma } from '@/lib/db'
import { success, unauthorized, notFound, serverError } from '@/lib/api-response'
import { calculateLimitingFactors } from '@/services/bom'

type RouteParams = { params: Promise<{ id: string }> }

// GET /api/skus/:id/limiting-factors - Get limiting components for buildable units
export async function GET(request: NextRequest, { params }: RouteParams) {
  try {
    const session = await getServerSession(authOptions)
    if (!session?.user) {
      return unauthorized()
    }

    const { id } = await params

    // Parse optional locationId query parameter
    const { searchParams } = new URL(request.url)
    const locationId = searchParams.get('locationId') ?? undefined

    // Use selected company for scoping
    const selectedCompanyId = session.user.selectedCompanyId
    const selectedBrandId = session.user.selectedBrandId

    // Verify SKU exists and user has access
    const sku = await prisma.sKU.findFirst({
      where: {
        id,
        companyId: selectedCompanyId,
        ...(selectedBrandId && { brandId: selectedBrandId }),
      },
      select: { id: true },
    })

    if (!sku) {
      return notFound('SKU')
    }

    // Calculate limiting factors
    const limitingFactors = await calculateLimitingFactors(id, locationId)

    return success(limitingFactors)
  } catch (error) {
    console.error('Error getting limiting factors:', error)
    return serverError()
  }
}
```

**Validation**:
```bash
npx tsc --noEmit
npm run build
```

**Completion Criteria**:
- [ ] Route file created in correct location
- [ ] Follows authentication pattern
- [ ] Validates SKU access
- [ ] Returns limiting factors data
- [ ] Supports locationId query param
- [ ] TypeScript compiles without errors
- [ ] Build passes

---

## Phase 5: Frontend Integration

### Subtask 5.1: Update SKU Detail Page to Use Clickable BuildableUnitsDisplay
**File**: `/home/pbrown/SkuInventory/src/app/(dashboard)/skus/[id]/page.tsx`
**Pattern**: Existing BuildableUnitsDisplay usage at line 187-190
**Instructions**:
1. Update the BuildableUnitsDisplay call to enable clicking:

Find:
```typescript
<BuildableUnitsDisplay
  maxBuildableUnits={sku.maxBuildableUnits}
  size="lg"
/>
```

Replace with:
```typescript
<BuildableUnitsDisplay
  maxBuildableUnits={sku.maxBuildableUnits}
  size="lg"
  skuId={sku.id}
  clickable={true}
/>
```

**Validation**:
```bash
npx tsc --noEmit
npm run build
```

**Completion Criteria**:
- [ ] SKU detail page updated
- [ ] Buildable units now clickable
- [ ] TypeScript compiles without errors
- [ ] Build passes

### Subtask 5.2: Update SKUTable to Make Buildable Column Clickable
**File**: `/home/pbrown/SkuInventory/src/components/features/SKUTable.tsx`
**Pattern**: Existing buildable cell at lines 198-206
**Instructions**:
1. Import the LimitingComponentsPopover at top of file
2. Update the buildable column cell to be clickable:

Find (around line 198-206):
```typescript
<TableCell className="text-right font-mono">
  {sku.maxBuildableUnits != null ? (
    <span className={sku.maxBuildableUnits === 0 ? 'text-red-600' : ''} suppressHydrationWarning>
      {sku.maxBuildableUnits.toLocaleString()}
    </span>
  ) : (
    '-'
  )}
</TableCell>
```

Replace with:
```typescript
<TableCell className="text-right font-mono">
  {sku.maxBuildableUnits != null ? (
    <LimitingComponentsPopover
      skuId={sku.id}
      maxBuildableUnits={sku.maxBuildableUnits}
      locationId={locationId}
    >
      <span
        className={`cursor-pointer hover:underline ${sku.maxBuildableUnits === 0 ? 'text-red-600' : ''}`}
        suppressHydrationWarning
      >
        {sku.maxBuildableUnits.toLocaleString()}
      </span>
    </LimitingComponentsPopover>
  ) : (
    '-'
  )}
</TableCell>
```

3. Add import at top:
```typescript
import { LimitingComponentsPopover } from './LimitingComponentsPopover'
```

**Validation**:
```bash
npx tsc --noEmit
npm run build
```

**Completion Criteria**:
- [ ] SKUTable updated with clickable buildable values
- [ ] Import added
- [ ] LocationId passed for location-filtered queries
- [ ] TypeScript compiles without errors
- [ ] Build passes

### Subtask 5.3: Update TopBuildableSkusList for Clickable Buildable Values
**File**: `/home/pbrown/SkuInventory/src/components/features/TopBuildableSkusList.tsx`
**Pattern**: Existing buildable cell at lines 82-86
**Instructions**:
1. Import LimitingComponentsPopover
2. Wrap the buildable span in the popover:

Find (around lines 82-86):
```typescript
<TableCell className="text-right font-mono">
  <span className={sku.maxBuildableUnits === 0 ? 'text-red-600' : 'text-green-600'} suppressHydrationWarning>
    {sku.maxBuildableUnits.toLocaleString()}
  </span>
</TableCell>
```

Replace with:
```typescript
<TableCell className="text-right font-mono">
  <LimitingComponentsPopover
    skuId={sku.id}
    maxBuildableUnits={sku.maxBuildableUnits}
  >
    <span
      className={`cursor-pointer hover:underline ${sku.maxBuildableUnits === 0 ? 'text-red-600' : 'text-green-600'}`}
      suppressHydrationWarning
    >
      {sku.maxBuildableUnits.toLocaleString()}
    </span>
  </LimitingComponentsPopover>
</TableCell>
```

3. Add import at top:
```typescript
import { LimitingComponentsPopover } from './LimitingComponentsPopover'
```

**Validation**:
```bash
npx tsc --noEmit
npm run build
```

**Completion Criteria**:
- [ ] TopBuildableSkusList updated
- [ ] Buildable values clickable in dashboard widget
- [ ] TypeScript compiles without errors
- [ ] Build passes

---

## Phase 6: Final Validation

### Subtask 6.1: Full Build and Type Check
**Instructions**:
```bash
npx tsc --noEmit
npm run build
npm run lint
```

**Completion Criteria**:
- [ ] No TypeScript errors
- [ ] Build completes successfully
- [ ] No lint errors

### Subtask 6.2: Manual Testing Checklist
**Instructions**:
1. Navigate to SKU detail page
2. Click on buildable units value
3. Verify popover opens with limiting components table
4. Verify top 3 components shown in correct order (most limiting first)
5. Verify component links work
6. Navigate to SKU list page
7. Click on buildable value in table
8. Verify popover works from table context
9. Navigate to dashboard
10. Click on buildable value in Top Buildable SKUs widget
11. Verify popover works from dashboard context

**Completion Criteria**:
- [ ] All click interactions work
- [ ] Popover shows correct limiting components
- [ ] Components sorted correctly (most limiting first)
- [ ] Component links navigate correctly
- [ ] Loading states display correctly
- [ ] Error states display correctly

---

## Summary of Deliverables

**Files Created**: 3
- `src/components/ui/popover.tsx`
- `src/components/features/LimitingComponentsPopover.tsx`
- `src/app/api/skus/[id]/limiting-factors/route.ts`

**Files Modified**: 5
- `src/types/sku.ts` - Add LimitingComponent type
- `src/services/bom.ts` - Add calculateLimitingFactors function
- `src/components/features/BuildableUnitsDisplay.tsx` - Add clickable functionality
- `src/components/features/SKUTable.tsx` - Make buildable column clickable
- `src/components/features/TopBuildableSkusList.tsx` - Make buildable values clickable

## Handoff to Build Agent

1. Execute subtasks in exact order (Phase 0 -> Phase 6)
2. Run npm install first for radix-ui dependency
3. Test completion criteria before moving to next subtask
4. Follow reference patterns exactly for consistent code style
5. Run `npx tsc --noEmit` after each file change
6. Run `npm run build` after completing each phase

## Test Strategy Note
- Manual testing is sufficient for this UI enhancement
- No automated tests required per task classification (nice-to-have feature)
- If time permits, consider E2E test for popover interaction

## Performance Metrics
| Phase | Duration |
|-------|----------|
| Investigation | 15m |
| Validation | 5m |
| Planning | 20m |
| **Total** | **40m** |
