# Implementation Plan
**Generated**: 2025-12-03T14:30:00Z
**Task ID**: Issue #33 - Dashboard console errors (hydration mismatches)
**Estimated Build Time**: 1-2 hours
**Complexity**: Low

## Executive Summary
Fix React hydration mismatch errors on the dashboard page caused by locale-dependent formatting methods (`.toLocaleDateString()` and `.toLocaleString()`) that produce different output between the server (Docker container) and client (user's browser). The fix adds React's `suppressHydrationWarning` attribute to JSX elements containing these locale-dependent values.

## Scope Decision
**Primary Scope (This Issue)**: Dashboard page and its child components (3 files, 6 instances)
**Future Work**: 14 additional files with 41 instances - recommend creating follow-up issue

## Phase 0: None Required
No complex code or blockers identified. The pattern is well-understood and straightforward.

## Phase 1: Dashboard Page Fixes

### Subtask 1.1: Add suppressHydrationWarning to Date TableCell
**File**: `/home/pbrown/SkuInventory/src/app/(dashboard)/page.tsx`
**Line**: 135
**Pattern Reference**: React documentation for `suppressHydrationWarning`
**Instructions**:
1. Locate the `TableCell` element at line 135 that contains `{new Date(tx.date).toLocaleDateString()}`
2. Add `suppressHydrationWarning` attribute to the `TableCell` element

**Before**:
```tsx
<TableCell className="font-mono text-sm">
  {new Date(tx.date).toLocaleDateString()}
</TableCell>
```

**After**:
```tsx
<TableCell className="font-mono text-sm" suppressHydrationWarning>
  {new Date(tx.date).toLocaleDateString()}
</TableCell>
```

**Validation Commands**:
```bash
npx tsc --noEmit
npm run build
```

**Completion Criteria**:
- [ ] `suppressHydrationWarning` added to line 135 TableCell
- [ ] TypeScript compilation passes
- [ ] Build completes successfully

### Subtask 1.2: Add suppressHydrationWarning to Quantity Change Span
**File**: `/home/pbrown/SkuInventory/src/app/(dashboard)/page.tsx`
**Line**: 157-166
**Pattern Reference**: React documentation for `suppressHydrationWarning`
**Instructions**:
1. Locate the `<span>` element (lines 157-166) that contains `{parseFloat(tx.lines[0].quantityChange).toLocaleString()}`
2. Add `suppressHydrationWarning` attribute to the `<span>` element

**Before**:
```tsx
<span
  className={`font-mono ${
    parseFloat(tx.lines[0].quantityChange) >= 0
      ? 'text-green-600'
      : 'text-red-600'
  }`}
>
  {parseFloat(tx.lines[0].quantityChange) >= 0 ? '+' : ''}
  {parseFloat(tx.lines[0].quantityChange).toLocaleString()}
</span>
```

**After**:
```tsx
<span
  className={`font-mono ${
    parseFloat(tx.lines[0].quantityChange) >= 0
      ? 'text-green-600'
      : 'text-red-600'
  }`}
  suppressHydrationWarning
>
  {parseFloat(tx.lines[0].quantityChange) >= 0 ? '+' : ''}
  {parseFloat(tx.lines[0].quantityChange).toLocaleString()}
</span>
```

**Validation Commands**:
```bash
npx tsc --noEmit
npm run build
```

**Completion Criteria**:
- [ ] `suppressHydrationWarning` added to span element
- [ ] TypeScript compilation passes
- [ ] Build completes successfully

## Phase 2: CriticalComponentsList Fixes

### Subtask 2.1: Add suppressHydrationWarning to Quantity On Hand TableCell
**File**: `/home/pbrown/SkuInventory/src/components/features/CriticalComponentsList.tsx`
**Line**: 77
**Pattern Reference**: Follow page.tsx pattern from Phase 1
**Instructions**:
1. Locate the `TableCell` at line 77 containing `{component.quantityOnHand.toLocaleString()}`
2. Add `suppressHydrationWarning` attribute

**Before**:
```tsx
<TableCell className="text-right font-mono">
  {component.quantityOnHand.toLocaleString()}
</TableCell>
```

**After**:
```tsx
<TableCell className="text-right font-mono" suppressHydrationWarning>
  {component.quantityOnHand.toLocaleString()}
</TableCell>
```

**Completion Criteria**:
- [ ] `suppressHydrationWarning` added to line 77 TableCell
- [ ] No TypeScript errors

### Subtask 2.2: Add suppressHydrationWarning to Reorder Point TableCell
**File**: `/home/pbrown/SkuInventory/src/components/features/CriticalComponentsList.tsx`
**Line**: 80
**Pattern Reference**: Follow page.tsx pattern from Phase 1
**Instructions**:
1. Locate the `TableCell` at line 80 containing `{component.reorderPoint.toLocaleString()}`
2. Add `suppressHydrationWarning` attribute

**Before**:
```tsx
<TableCell className="text-right font-mono">
  {component.reorderPoint.toLocaleString()}
</TableCell>
```

**After**:
```tsx
<TableCell className="text-right font-mono" suppressHydrationWarning>
  {component.reorderPoint.toLocaleString()}
</TableCell>
```

**Completion Criteria**:
- [ ] `suppressHydrationWarning` added to line 80 TableCell
- [ ] No TypeScript errors

### Subtask 2.3: Add suppressHydrationWarning to Deficit TableCell
**File**: `/home/pbrown/SkuInventory/src/components/features/CriticalComponentsList.tsx`
**Line**: 83
**Pattern Reference**: Follow page.tsx pattern from Phase 1
**Instructions**:
1. Locate the `TableCell` at line 83 containing `-{deficit.toLocaleString()}`
2. Add `suppressHydrationWarning` attribute

**Before**:
```tsx
<TableCell className="text-right font-mono text-red-600">
  -{deficit.toLocaleString()}
</TableCell>
```

**After**:
```tsx
<TableCell className="text-right font-mono text-red-600" suppressHydrationWarning>
  -{deficit.toLocaleString()}
</TableCell>
```

**Validation Commands**:
```bash
npx tsc --noEmit
npm run build
```

**Completion Criteria**:
- [ ] `suppressHydrationWarning` added to line 83 TableCell
- [ ] TypeScript compilation passes
- [ ] Build completes successfully

## Phase 3: TopBuildableSkusList Fixes

### Subtask 3.1: Add suppressHydrationWarning to Max Buildable Units Span
**File**: `/home/pbrown/SkuInventory/src/components/features/TopBuildableSkusList.tsx`
**Line**: 78-80
**Pattern Reference**: Follow page.tsx pattern from Phase 1
**Instructions**:
1. Locate the `<span>` at lines 78-80 containing `{sku.maxBuildableUnits.toLocaleString()}`
2. Add `suppressHydrationWarning` attribute

**Before**:
```tsx
<span className={sku.maxBuildableUnits === 0 ? 'text-red-600' : 'text-green-600'}>
  {sku.maxBuildableUnits.toLocaleString()}
</span>
```

**After**:
```tsx
<span className={sku.maxBuildableUnits === 0 ? 'text-red-600' : 'text-green-600'} suppressHydrationWarning>
  {sku.maxBuildableUnits.toLocaleString()}
</span>
```

**Validation Commands**:
```bash
npx tsc --noEmit
npm run build
```

**Completion Criteria**:
- [ ] `suppressHydrationWarning` added to span element
- [ ] TypeScript compilation passes
- [ ] Build completes successfully

## Phase 4: Verification and Testing

### Subtask 4.1: Full Build Verification
**Instructions**:
1. Run full TypeScript check
2. Run full build
3. Run lint check

**Validation Commands**:
```bash
# TypeScript check
npx tsc --noEmit

# Full build
npm run build

# Lint check (if applicable)
npm run lint
```

**Completion Criteria**:
- [ ] TypeScript check passes with no errors
- [ ] Build completes successfully
- [ ] No new lint warnings

### Subtask 4.2: Manual Testing
**Instructions**:
1. Start the application (if not already running in Docker)
2. Navigate to dashboard at http://172.16.20.50:4545
3. Open browser console (F12 -> Console tab)
4. Verify NO React hydration errors appear:
   - No Error #425 (Text content does not match)
   - No Error #418 (Hydration mismatch)
   - No Error #423 (Hydration error with recovery)
5. Verify dashboard displays correctly:
   - Dashboard stats visible
   - Critical components list displays with proper number formatting
   - Top buildable SKUs list displays with proper number formatting
   - Recent transactions table displays with proper date and number formatting

**Completion Criteria**:
- [ ] Dashboard loads without React hydration errors
- [ ] All dashboard statistics display correctly
- [ ] Critical components list shows correct numbers
- [ ] Top buildable SKUs list shows correct numbers
- [ ] Recent transactions show correct dates and quantities

## Phase 5: Documentation and Follow-up

### Subtask 5.1: Update GitHub Issue
**Instructions**:
1. Comment on issue #33 with findings and fix summary
2. Reference the commit that fixes the issue

**Completion Criteria**:
- [ ] Issue #33 updated with resolution details

### Subtask 5.2: Create Follow-up Issue (Optional)
**Instructions**:
If time permits, create a new GitHub issue to address the remaining 41 instances of locale-dependent formatting in 14 other files:

**Files requiring future attention**:
| File | Instances |
|------|-----------|
| `/src/app/(dashboard)/transactions/page.tsx` | 2 |
| `/src/app/(dashboard)/components/[id]/page.tsx` | 6 |
| `/src/app/(dashboard)/skus/[id]/page.tsx` | 4 |
| `/src/components/features/TransactionDetail.tsx` | 4 |
| `/src/components/features/BuildDialog.tsx` | 5 |
| `/src/components/features/UserTable.tsx` | 1 |
| `/src/components/features/ComponentTable.tsx` | 1 |
| `/src/components/features/BuildableUnitsDisplay.tsx` | 1 |
| `/src/components/features/BOMVersionList.tsx` | 2 |
| `/src/components/features/InsufficientInventoryWarning.tsx` | 5 |
| `/src/components/features/DefectAnalyticsSummary.tsx` | 4 |
| `/src/components/features/SKUTable.tsx` | 1 |
| `/src/components/ui/BuildFooter.tsx` | 1 (uses explicit 'en-US' locale) |
| `/src/components/features/DefectTrendChart.tsx` | 3 (uses explicit 'en-US' locale) |

**Note**: Files using explicit 'en-US' locale may not have hydration issues but should still be reviewed for consistency.

**Completion Criteria**:
- [ ] Follow-up issue created (optional)

## Summary of Deliverables

**Files Modified**: 3
| File | Changes |
|------|---------|
| `/home/pbrown/SkuInventory/src/app/(dashboard)/page.tsx` | 2 `suppressHydrationWarning` attributes added |
| `/home/pbrown/SkuInventory/src/components/features/CriticalComponentsList.tsx` | 3 `suppressHydrationWarning` attributes added |
| `/home/pbrown/SkuInventory/src/components/features/TopBuildableSkusList.tsx` | 1 `suppressHydrationWarning` attribute added |

**Total Changes**: 6 instances of `suppressHydrationWarning` attribute added

**Files NOT Modified**:
- `/home/pbrown/SkuInventory/src/components/features/DashboardStats.tsx` - Renders plain numbers without locale formatting

## Handoff to Build Agent

### Execution Order
1. Execute Phase 1 subtasks (page.tsx) in order
2. Execute Phase 2 subtasks (CriticalComponentsList.tsx) in order
3. Execute Phase 3 subtask (TopBuildableSkusList.tsx)
4. Execute Phase 4 verification
5. Execute Phase 5 documentation (optional)

### Key Implementation Notes
1. The `suppressHydrationWarning` attribute is a React built-in - no imports needed
2. This attribute should be placed on the OUTERMOST element that contains the locale-dependent content
3. The attribute accepts a boolean, but when true can be written as just `suppressHydrationWarning` (shorthand)
4. Each file should pass TypeScript check after modification before proceeding

### Risk Mitigation
- **Low Risk**: Using React's official recommended approach for locale-dependent content
- **No Breaking Changes**: Purely additive attribute that suppresses warnings
- **Rollback**: Simple - remove the `suppressHydrationWarning` attributes

### Testing Requirements
- Manual browser console inspection is the primary verification method
- E2E tests in `tests/e2e/full-workflow.spec.ts` reference dashboard but do not check for console errors
- No unit tests exist for these specific components

## Performance Metrics
| Phase | Duration |
|-------|----------|
| Scout Review | 5m |
| Pattern Research | 3m |
| File Verification | 8m |
| Plan Writing | 15m |
| **Total** | **31m** |

---

AGENT_RETURN: plan-33-120325
