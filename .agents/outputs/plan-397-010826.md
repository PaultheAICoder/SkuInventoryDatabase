# Implementation Plan

**Issue**: #397 - Add vendors/suppliers management to sidebar navigation
**Tier**: 2 (Standard)
**Type**: Feature
**Est. Time**: 4-6 hours
**Category**: NEW_FEATURE
**Test Strategy**: TARGETED

## Summary

Add a new Vendor model to manage suppliers/vendors as first-class entities rather than free-form text fields. This includes a full CRUD management page in the Settings section following the existing Location/Category/Brand patterns, with company-scoped vendors and admin-only access.

## Current State

- Transactions currently store `supplier` as a `String @db.VarChar(100)` free-text field
- `/api/suppliers/route.ts` exists but only returns distinct supplier strings from past transactions
- No `Vendor` model exists in the database
- Sidebar settings section includes: Locations, Brands, Categories, Companies
- Existing pattern: `src/app/(dashboard)/settings/locations/` provides complete reference for page structure
- ReceiptDialog.tsx has a text input for supplier (currently free-form)

## Dependencies

- **None** - This is a self-contained feature that adds new functionality
- Future enhancement: Replace supplier text field with vendor dropdown (out of scope for this issue)

## Patterns to Follow

| Pattern | Reference File | Usage |
|---------|---------------|-------|
| Type definitions | `/home/pbrown/SkuInventory/src/types/location.ts` | Zod schemas, response types |
| List API route | `/home/pbrown/SkuInventory/src/app/api/locations/route.ts` | GET/POST with company scoping |
| Detail API route | `/home/pbrown/SkuInventory/src/app/api/locations/[id]/route.ts` | GET/PATCH/DELETE by ID |
| List page | `/home/pbrown/SkuInventory/src/app/(dashboard)/settings/locations/page.tsx` | Search, filters, data table |
| Form component | `/home/pbrown/SkuInventory/src/components/features/LocationForm.tsx` | Create/Edit form |
| Table component | `/home/pbrown/SkuInventory/src/components/features/LocationTable.tsx` | Data display with actions |
| Sidebar nav | `/home/pbrown/SkuInventory/src/app/(dashboard)/layout.tsx:62-72` | Settings sub-navigation |

## Changes Required

### Phase 1: Database Layer

| Subtask | File | Change | Completion Criteria |
|---------|------|--------|---------------------|
| 1.1 | `/home/pbrown/SkuInventory/prisma/schema.prisma` | Add Vendor model with Company relation | [ ] Model added after Category model (around line 113), [ ] Fields: id, companyId, name, contactEmail, contactPhone, address, notes, isActive, createdAt, updatedAt, [ ] Company relation added, [ ] Unique constraint on [companyId, name], [ ] Index on [companyId, isActive] |
| 1.2 | Run migration | `npx prisma migrate dev --name add-vendor-model` | [ ] Migration successful, [ ] Prisma client regenerated |

**Vendor Model Definition:**
```prisma
model Vendor {
  id           String   @id @default(uuid())
  companyId    String
  company      Company  @relation(fields: [companyId], references: [id])
  name         String   @db.VarChar(100)
  contactEmail String?  @db.VarChar(255)
  contactPhone String?  @db.VarChar(50)
  address      String?  @db.Text
  notes        String?  @db.Text
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@unique([companyId, name])
  @@index([companyId, isActive])
}
```

**Update Company model relation (around line 41):**
```prisma
  vendors          Vendor[]
```

### Phase 2: Types Layer

| Subtask | File | Change | Completion Criteria |
|---------|------|--------|---------------------|
| 2.1 | `/home/pbrown/SkuInventory/src/types/vendor.ts` (new) | Create type definitions | [ ] createVendorSchema with name (required), contactEmail, contactPhone, address, notes, [ ] updateVendorSchema with all optional fields + isActive, [ ] vendorListQuerySchema with pagination, search, isActive filter, sorting, [ ] VendorResponse interface |

**Type File Pattern (follow location.ts):**
```typescript
import { z } from 'zod'

// Vendor create schema (admin only)
export const createVendorSchema = z.object({
  name: z.string().min(1, 'Name is required').max(100),
  contactEmail: z.string().email('Invalid email').max(255).optional().nullable(),
  contactPhone: z.string().max(50).optional().nullable(),
  address: z.string().optional().nullable(),
  notes: z.string().optional().nullable(),
})

export type CreateVendorInput = z.infer<typeof createVendorSchema>

// Vendor update schema (admin only)
export const updateVendorSchema = z.object({
  name: z.string().min(1, 'Name is required').max(100).optional(),
  contactEmail: z.string().email('Invalid email').max(255).optional().nullable(),
  contactPhone: z.string().max(50).optional().nullable(),
  address: z.string().optional().nullable(),
  notes: z.string().optional().nullable(),
  isActive: z.boolean().optional(),
})

export type UpdateVendorInput = z.infer<typeof updateVendorSchema>

// Vendor list query schema
export const vendorListQuerySchema = z.object({
  page: z.coerce.number().int().positive().default(1),
  pageSize: z.coerce.number().int().positive().max(100).default(50),
  search: z.string().optional(),
  isActive: z
    .string()
    .transform((val) => val === 'true')
    .optional(),
  sortBy: z.enum(['name', 'createdAt']).default('name'),
  sortOrder: z.enum(['asc', 'desc']).default('asc'),
})

export type VendorListQuery = z.infer<typeof vendorListQuerySchema>

// Vendor response type (what API returns)
export interface VendorResponse {
  id: string
  name: string
  contactEmail: string | null
  contactPhone: string | null
  address: string | null
  notes: string | null
  isActive: boolean
  createdAt: string
  updatedAt: string
}
```

### Phase 3: API Routes

| Subtask | File | Change | Completion Criteria |
|---------|------|--------|---------------------|
| 3.1 | `/home/pbrown/SkuInventory/src/app/api/vendors/route.ts` (new) | Create list/create endpoints | [ ] GET returns paginated vendors with search/filter, [ ] POST creates vendor (admin only), [ ] Company scoping via selectedCompanyId, [ ] Duplicate name check |
| 3.2 | `/home/pbrown/SkuInventory/src/app/api/vendors/[id]/route.ts` (new) | Create detail/update/delete endpoints | [ ] GET returns single vendor, [ ] PATCH updates vendor (admin only), [ ] DELETE soft-deletes (sets isActive=false), [ ] Company scoping enforced |

**API Pattern Notes:**
- Follow `/api/locations/route.ts` exactly for authentication and company scoping
- Use `getServerSession(authOptions)` for auth
- Use `isAdminInAnyCompany(session)` for write operations
- Use `session.user.selectedCompanyId` for scoping

### Phase 4: Components

| Subtask | File | Change | Completion Criteria |
|---------|------|--------|---------------------|
| 4.1 | `/home/pbrown/SkuInventory/src/components/features/VendorTable.tsx` (new) | Create table component | [ ] Displays vendor list with columns: Name, Contact, Status, Actions, [ ] Edit link, toggle active action, [ ] Uses shadcn Table, Badge, DropdownMenu |
| 4.2 | `/home/pbrown/SkuInventory/src/components/features/VendorForm.tsx` (new) | Create form component | [ ] Fields: name, contactEmail, contactPhone, address, notes, isActive (edit only), [ ] Handles create and edit modes, [ ] Redirects to list on success |

### Phase 5: Pages

| Subtask | File | Change | Completion Criteria |
|---------|------|--------|---------------------|
| 5.1 | `/home/pbrown/SkuInventory/src/app/(dashboard)/settings/vendors/page.tsx` (new) | Create list page | [ ] Search and filter UI, [ ] VendorTable component, [ ] "Add Vendor" button |
| 5.2 | `/home/pbrown/SkuInventory/src/app/(dashboard)/settings/vendors/new/page.tsx` (new) | Create new vendor page | [ ] Back button to list, [ ] VendorForm component |
| 5.3 | `/home/pbrown/SkuInventory/src/app/(dashboard)/settings/vendors/[id]/edit/page.tsx` (new) | Create edit page | [ ] Fetch vendor by ID, [ ] VendorForm with vendor data, [ ] Loading/error states |

### Phase 6: Navigation

| Subtask | File | Change | Completion Criteria |
|---------|------|--------|---------------------|
| 6.1 | `/home/pbrown/SkuInventory/src/app/(dashboard)/layout.tsx` | Add Vendors to settings navigation | [ ] Add after Categories (line 68), [ ] Use `Truck` icon from lucide-react, [ ] href: '/settings/vendors' |

**Sidebar Change (around line 68):**
```typescript
// Add import at top:
import { Truck } from 'lucide-react'

// Add to settingsNavigation array after Categories:
{ name: 'Vendors', href: '/settings/vendors', icon: Truck },
```

## Validation Commands

After each phase, run:
```bash
# TypeScript check
npx tsc --noEmit

# Build check
npm run build

# Lint check
npm run lint
```

## Files Summary

**Created**: 8 files
- `prisma/schema.prisma` (modified - add Vendor model)
- `src/types/vendor.ts`
- `src/app/api/vendors/route.ts`
- `src/app/api/vendors/[id]/route.ts`
- `src/components/features/VendorTable.tsx`
- `src/components/features/VendorForm.tsx`
- `src/app/(dashboard)/settings/vendors/page.tsx`
- `src/app/(dashboard)/settings/vendors/new/page.tsx`
- `src/app/(dashboard)/settings/vendors/[id]/edit/page.tsx`

**Modified**: 2 files
- `prisma/schema.prisma` (add Vendor model and Company relation)
- `src/app/(dashboard)/layout.tsx` (add sidebar navigation item)

## Out of Scope

The following items are mentioned in the issue but are enhancement work for future issues:
- Vendor dropdown in receipt transaction forms (replaces current text input)
- Natural language parsing for vendor name matching
- vendorId foreign key on Transaction model

These should be separate follow-up issues after the base Vendor management is complete.

## Performance Metrics

| Phase | Estimated Duration |
|-------|-------------------|
| Investigation | 15m |
| Phase 1: Database | 15m |
| Phase 2: Types | 15m |
| Phase 3: API Routes | 45m |
| Phase 4: Components | 60m |
| Phase 5: Pages | 45m |
| Phase 6: Navigation | 10m |
| Testing & Validation | 30m |
| **Total** | **4-5 hours** |
