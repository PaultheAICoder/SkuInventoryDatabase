# Quick Fix Plan

**Issue**: #386 - [Rec Engine] Add confidence scoring UI display
**Tier**: 1 (Quick Fix)
**Type**: Enhancement
**Est. Time**: 1-2 hours
**Generated**: 2026-01-09
**Generated By**: Scout-and-Plan Agent (combined workflow)

---

## Investigation Summary

### Issue Validation

**Status**: Partially Obsolete - Most work already done

The issue states:
1. "Add confidence badge to RecommendationCard component" - **ALREADY EXISTS** (line 223-225 of RecommendationCard.tsx)
2. "Add confidence filter dropdown to recommendations list" - **ALREADY EXISTS** (lines 371-387 of recommendations/page.tsx)
3. "Display confidence reasoning on hover/tooltip" - **THIS IS MISSING** (actual remaining work)

### Current State

**Existing Implementation:**
- `/home/pbrown/SkuInventory/src/components/features/RecommendationCard.tsx` - Lines 223-225 display confidence badge
- `/home/pbrown/SkuInventory/src/app/(dashboard)/recommendations/page.tsx` - Lines 371-387 provide confidence filter dropdown
- `/home/pbrown/SkuInventory/src/services/recommendations/confidence-scoring.ts` - Line 106 has `getConfidenceDescription()` function (exported but UNUSED in UI)
- `/home/pbrown/SkuInventory/src/lib/recommendation-utils.ts` - Line 223 has `getConfidenceLevelLabel()` function (USED in UI)

**What's Missing:**
- No tooltip component exists (`@radix-ui/react-tooltip` not installed)
- No `src/components/ui/tooltip.tsx` file
- `getConfidenceDescription` function is not used in the UI - only `getConfidenceLevelLabel` is used

### Pattern Reference

**Primary Pattern**: `/home/pbrown/SkuInventory/src/components/ui/popover.tsx`
- Standard shadcn/ui component structure
- Uses Radix primitives
- Follows existing styling conventions

**Badge Display (to wrap with tooltip)**: `/home/pbrown/SkuInventory/src/components/features/RecommendationCard.tsx` lines 223-225:
```tsx
<Badge variant="outline" className={confidenceColors[recommendation.confidence]}>
  {getConfidenceLevelLabel(recommendation.confidence)}
</Badge>
```

---

## The Fix

The RecommendationCard already displays a confidence badge and the recommendations page already has a confidence filter. The only missing piece is a tooltip that explains WHY a recommendation has a given confidence level when hovering over the badge.

**Solution:**
1. Install `@radix-ui/react-tooltip` package
2. Create standard shadcn/ui Tooltip component
3. Wrap the confidence badge in RecommendationCard with a tooltip showing the description from `getConfidenceDescription()`

---

## Changes Required

| File | Line | Change |
|------|------|--------|
| `package.json` | 24-70 | Add `@radix-ui/react-tooltip` dependency |
| `src/components/ui/tooltip.tsx` | NEW | Create shadcn/ui Tooltip component |
| `src/components/features/RecommendationCard.tsx` | 22, 223-225 | Import Tooltip, wrap Badge with tooltip showing confidence description |

---

## Phase 1: Install Tooltip Dependency

### Subtask 1.1: Install @radix-ui/react-tooltip package

**Instructions**:
```bash
npm install @radix-ui/react-tooltip
```

**Completion Criteria**:
- [ ] Package added to package.json dependencies
- [ ] node_modules updated

---

## Phase 2: Create Tooltip Component

### Subtask 2.1: Create shadcn/ui Tooltip Component

**File**: `/home/pbrown/SkuInventory/src/components/ui/tooltip.tsx` (NEW FILE)

**Pattern Reference**: `/home/pbrown/SkuInventory/src/components/ui/popover.tsx`

**Instructions**:
Create a new Tooltip component following shadcn/ui conventions:

```tsx
'use client'

import * as React from 'react'
import * as TooltipPrimitive from '@radix-ui/react-tooltip'
import { cn } from '@/lib/utils'

const TooltipProvider = TooltipPrimitive.Provider

const Tooltip = TooltipPrimitive.Root

const TooltipTrigger = TooltipPrimitive.Trigger

const TooltipContent = React.forwardRef<
  React.ElementRef<typeof TooltipPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <TooltipPrimitive.Portal>
    <TooltipPrimitive.Content
      ref={ref}
      sideOffset={sideOffset}
      className={cn(
        'z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2',
        className
      )}
      {...props}
    />
  </TooltipPrimitive.Portal>
))
TooltipContent.displayName = TooltipPrimitive.Content.displayName

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }
```

**Completion Criteria**:
- [ ] File created at `/home/pbrown/SkuInventory/src/components/ui/tooltip.tsx`
- [ ] Exports: `Tooltip`, `TooltipTrigger`, `TooltipContent`, `TooltipProvider`
- [ ] `npx tsc --noEmit` passes

---

## Phase 3: Update RecommendationCard

### Subtask 3.1: Add Tooltip to Confidence Badge

**File**: `/home/pbrown/SkuInventory/src/components/features/RecommendationCard.tsx`

**Instructions**:

1. Add import for Tooltip components (after line 6):
```tsx
import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip'
```

2. Add import for `getConfidenceDescription` (update line 17-23):
```tsx
import {
  getRecommendationTypeLabel,
  getConfidenceLevelLabel,
  calculateImprovementPercentage,
} from '@/lib/recommendation-utils'
import { getConfidenceDescription } from '@/services/recommendations/confidence-scoring'
```

3. Wrap the confidence Badge (lines 223-225) with Tooltip:

**Before** (line 223-225):
```tsx
<Badge variant="outline" className={confidenceColors[recommendation.confidence]}>
  {getConfidenceLevelLabel(recommendation.confidence)}
</Badge>
```

**After**:
```tsx
<TooltipProvider>
  <Tooltip>
    <TooltipTrigger asChild>
      <Badge variant="outline" className={`${confidenceColors[recommendation.confidence]} cursor-help`}>
        {getConfidenceLevelLabel(recommendation.confidence)}
      </Badge>
    </TooltipTrigger>
    <TooltipContent className="max-w-xs">
      <p>{getConfidenceDescription(recommendation.confidence)}</p>
    </TooltipContent>
  </Tooltip>
</TooltipProvider>
```

**Note**: Added `cursor-help` class to indicate the badge is hoverable.

**Completion Criteria**:
- [ ] Tooltip imports added
- [ ] `getConfidenceDescription` imported from confidence-scoring service
- [ ] Badge wrapped with Tooltip showing confidence description on hover
- [ ] `cursor-help` class added for UX hint
- [ ] `npx tsc --noEmit` passes
- [ ] `npm run build` passes
- [ ] `npm run lint` passes

---

## Phase 4: Manual Verification

### Subtask 4.1: Visual Verification

**Instructions**:
1. Start dev server: `npm run dev`
2. Navigate to http://172.16.20.50:2345/recommendations
3. Verify confidence badge displays on recommendation cards
4. Hover over a confidence badge
5. Verify tooltip appears with explanation text:
   - HIGH: "Based on 30+ days of data with significant volume. High reliability."
   - MEDIUM: "Based on 14-29 days of data with moderate volume. Good reliability."
   - LOW: "Based on limited data. Consider gathering more data before acting."

**Completion Criteria**:
- [ ] Tooltip appears on hover
- [ ] Tooltip shows correct description for each confidence level
- [ ] Tooltip dismisses when not hovering

---

## Validation Commands

```bash
# TypeScript check
npx tsc --noEmit

# Build check
npm run build

# Lint check
npm run lint
```

---

## Summary of Deliverables

**Files Created**: 1
- `src/components/ui/tooltip.tsx` - New shadcn/ui Tooltip component

**Files Modified**: 2
- `package.json` - Add @radix-ui/react-tooltip dependency
- `src/components/features/RecommendationCard.tsx` - Add tooltip to confidence badge

**Dependencies Added**: 1
- `@radix-ui/react-tooltip`

---

## Task Classification

**Category**: ENHANCEMENT (adding missing UX feature to existing UI)
**Test Strategy**: FAST_PATH - No automated tests needed, visual verification sufficient

---

## Acceptance Criteria (from Issue)

| Criteria | Status | Implementation |
|----------|--------|----------------|
| Recommendations show confidence level (High/Medium/Low) badge | ALREADY EXISTS | Line 223-225 of RecommendationCard.tsx |
| Users can filter recommendations by confidence level | ALREADY EXISTS | Lines 371-387 of recommendations/page.tsx |
| Tooltip explains why a recommendation has its confidence score | TO BE IMPLEMENTED | Wrap badge with Tooltip using getConfidenceDescription |

---

## Notes

- The issue description suggests more work is needed than actually required
- Two of three acceptance criteria are already implemented
- Only the tooltip/hover explanation is missing
- This is a minimal change that leverages existing infrastructure
