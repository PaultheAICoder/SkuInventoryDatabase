# Implementation Plan
**Generated**: 2025-12-09T14:30:00Z
**Generated By**: Scout-and-Plan Agent (combined workflow)
**Task ID**: GitHub Issue #222
**Estimated Build Time**: 1-2 hours
**Complexity**: Low

## Investigation Summary

### Request Analysis
**Type**: Bug
**Source**: GitHub Issue #222
**Priority**: Medium

### Task Classification
**Category**: BUG_FIX
**Test Strategy**: TARGETED
**Suggested Filter**: `--filter="QuickEntry"` or None (no existing tests for these components)

### Issue Validation
**Status**: Valid
**Recent Changes**: No recent changes to affected files that would have fixed this

### Current State Assessment
- **Root Cause Identified**: The error handling code in QuickEntryForm.tsx and QuickEntryWrapper.tsx displays `data.error` (the error code like "BadRequest") instead of `data.message` (the human-readable error message)
- **API Response Format**:
  ```json
  {
    "error": "BadRequest",  // Error code
    "message": "No location available for outbound transaction",  // Human-readable message
    "details": [...]  // Optional validation details
  }
  ```
- **Bug Location**: Lines 296 and 109 in the respective files check `data?.error || data?.message` which displays the error code first

### Dependencies & Blockers
None - this is a simple string order fix

**Can Proceed?**: YES

### Complexity Assessment
**Complexity**: Simple
**Effort**: 1-2 hours
**Risk**: Low - isolated change to error display logic

### Patterns Identified
**Primary**: Other error handlers in the codebase use `data?.message || data?.error` (correct order)
**Example Files**:
- `/home/pbrown/SkuInventory/src/components/features/AdjustmentDialog.tsx` line 108
- `/home/pbrown/SkuInventory/src/components/features/ReceiptDialog.tsx` line 103
- `/home/pbrown/SkuInventory/src/components/features/TransferDialog.tsx` line 111

### Ripple Effect Analysis
**Files Identified**: 2
- `/home/pbrown/SkuInventory/src/components/features/QuickEntryForm.tsx` - Primary form component
- `/home/pbrown/SkuInventory/src/components/features/QuickEntryWrapper.tsx` - Wrapper with conversational input

**TOTAL FILES AFFECTED**: 2

---

## Executive Summary
The outbound transaction form displays "badrequest" instead of the actual error message because the error handling code checks `data.error` (the error code) before `data.message` (the human-readable message). The fix is to swap the order to `data?.message || data?.error`.

## Phase 1: Fix Error Message Display Order

### Subtask 1.1: Fix QuickEntryForm.tsx Error Handling
**File**: `/home/pbrown/SkuInventory/src/components/features/QuickEntryForm.tsx`
**Line**: 296
**Pattern**: Follow `/home/pbrown/SkuInventory/src/components/features/AdjustmentDialog.tsx` line 108

**Instructions**:
1. Locate line 296:
   ```typescript
   throw new Error(data?.error || data?.message || 'Failed to record transaction')
   ```
2. Change to:
   ```typescript
   throw new Error(data?.message || data?.error || 'Failed to record transaction')
   ```

**Validation Commands**:
```bash
npx tsc --noEmit
npm run build
```

**Completion Criteria**:
- [ ] Error message order is swapped to `message || error`
- [ ] TypeScript compiles without errors
- [ ] Build succeeds

### Subtask 1.2: Fix QuickEntryWrapper.tsx Error Handling
**File**: `/home/pbrown/SkuInventory/src/components/features/QuickEntryWrapper.tsx`
**Line**: 109
**Pattern**: Same as Subtask 1.1

**Instructions**:
1. Locate line 109:
   ```typescript
   throw new Error(data?.error || data?.message || 'Failed to record transaction')
   ```
2. Change to:
   ```typescript
   throw new Error(data?.message || data?.error || 'Failed to record transaction')
   ```

**Validation Commands**:
```bash
npx tsc --noEmit
npm run build
```

**Completion Criteria**:
- [ ] Error message order is swapped to `message || error`
- [ ] TypeScript compiles without errors
- [ ] Build succeeds

## Phase 2: Manual Verification (Test Environment)

### Subtask 2.1: Verify Fix in Test Environment
**Instructions**:
1. Start the test environment if not running:
   ```bash
   cd /home/pbrown/SkuInventory/docker && docker compose -f docker-compose.test.yml up -d
   ```
2. Access the test app at http://172.16.20.50:2345
3. Navigate to Transactions > New Transaction
4. Select "Outbound Shipment"
5. Fill in required fields (SKU, Sales Channel, Quantity)
6. Submit the form
7. If an error occurs (e.g., "Insufficient finished goods"), verify the error message is human-readable, not "BadRequest"

**Completion Criteria**:
- [ ] Error messages display actual error text (e.g., "Insufficient finished goods at location. Available: 0, Required: 10")
- [ ] No "BadRequest" or "ValidationError" codes shown to users

---

## Summary of Deliverables
**Files Created**: 0
**Files Modified**: 2
- `/home/pbrown/SkuInventory/src/components/features/QuickEntryForm.tsx` - Line 296
- `/home/pbrown/SkuInventory/src/components/features/QuickEntryWrapper.tsx` - Line 109

## Handoff to Build Agent
1. Execute subtasks in exact order
2. Both changes are identical (swap `data?.error || data?.message` to `data?.message || data?.error`)
3. Run build validation after each change
4. Manual verification in test environment recommended

## Test Strategy Note
- No existing unit tests for these components
- Manual UI testing recommended via test environment
- This is a display-only change with no data impact

## Root Cause Summary
The API response format includes both:
- `error`: Error code (e.g., "BadRequest", "ValidationError", "NotFound")
- `message`: Human-readable description (e.g., "No location available for outbound transaction")

The bug was checking `error` first, showing users technical codes instead of helpful messages.

## Performance Metrics
| Phase | Duration |
|-------|----------|
| Investigation | 15m |
| Validation | 5m |
| Planning | 5m |
| **Total** | **25m** |
