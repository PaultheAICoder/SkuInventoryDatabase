# Implementation Plan
**Generated**: 2025-12-04T15:30:00Z
**Generated By**: Scout-and-Plan Agent (combined workflow)
**Task ID**: Issue #124
**Estimated Build Time**: 4-6 hours
**Complexity**: Medium

## Investigation Summary

### Request Analysis
**Type**: Feature (Admin CRUD page)
**Source**: GitHub Issue #124
**Priority**: Medium
**Parent Issue**: #20 (Multi-brand UI support - CLOSED)

### Task Classification
**Category**: NEW_FEATURE
**Test Strategy**: TARGETED (affected modules - brand management)
**Suggested Filter**: None (no existing tests for brand management)

### Issue Validation
**Status**: Valid
**Recent Changes**: Commit 04a7dce added brand selector UI and switch API as part of #20. No existing brand CRUD routes.

### Current State Assessment
- **Database**: Brand model exists in Prisma schema with:
  - `id`, `companyId`, `name`, `isActive`, `createdAt`, `updatedAt`
  - Unique constraint: `@@unique([companyId, name])`
  - Relations: belongs to Company, has many Components and SKUs
- **Existing Brand API**: Only `/api/brands/switch` route exists (for brand switching)
- **Missing**:
  - No `/api/brands` route (list/create)
  - No `/api/brands/[id]` route (get/update/delete)
  - No `/settings/brands` page
  - No `src/types/brand.ts` file
  - No `BrandTable.tsx` or `BrandForm.tsx` components

### Dependencies & Blockers
1. **None identified** - Brand model exists, similar patterns available

**Can Proceed?**: YES

### Complexity Assessment
**Complexity**: Medium (new feature with established patterns)
**Effort**: 4-6 hours
**Risk**: Low - follows existing CRUD patterns exactly

### Patterns Identified
**Primary**: Location management (settings/locations)
- Most similar: brand scoped by company (like location), has isActive flag
- `/src/app/(dashboard)/settings/locations/page.tsx` - list page pattern
- `/src/app/api/locations/route.ts` - GET/POST pattern
- `/src/app/api/locations/[id]/route.ts` - GET/PATCH/DELETE pattern
- `/src/components/features/LocationTable.tsx` - table with actions
- `/src/components/features/LocationForm.tsx` - create/edit form
- `/src/types/location.ts` - Zod schemas and response types

**Secondary**: Company management (simpler form, similar table structure)
- `/src/app/(dashboard)/settings/companies/page.tsx`
- `/src/components/features/CompanyTable.tsx`
- `/src/components/features/CompanyForm.tsx`

### Ripple Effect Analysis
**Files Identified**: 4 (session update when brands change)
- `/src/lib/auth.ts` - Already loads brands for session, needs update after CRUD
- `/src/components/features/BrandSelector.tsx` - May need refresh after brand changes
- `/src/app/api/companies/switch/route.ts` - Already refreshes brands on company switch
- `/src/app/(dashboard)/layout.tsx` - Contains sidebar navigation (needs Brands link)

**TOTAL FILES AFFECTED (New)**: 10 new files to create
**TOTAL FILES AFFECTED (Modified)**: 1 file to modify (layout.tsx for nav)

---

## Executive Summary
Create a brand management admin page at `/settings/brands` with full CRUD operations. This includes API routes for listing, creating, reading, updating, and soft-deleting brands scoped to the selected company. The UI will follow existing patterns from Location and Company management pages.

## Phase 1: Types Layer
### Subtask 1.1: Create Brand Types and Schemas
**File**: `/home/pbrown/SkuInventory/src/types/brand.ts`
**Pattern**: Follow `/home/pbrown/SkuInventory/src/types/location.ts` (lines 1-62)
**Instructions**:
1. Create Zod schemas for:
   - `createBrandSchema`: name (required, max 100)
   - `updateBrandSchema`: name (optional), isActive (optional)
   - `brandListQuerySchema`: page, pageSize, search, isActive, sortBy, sortOrder
2. Export TypeScript types from schemas
3. Create `BrandResponse` interface: id, name, isActive, componentCount, skuCount, createdAt, updatedAt

**Code snippet**:
```typescript
import { z } from 'zod'

// Brand create schema (admin only)
export const createBrandSchema = z.object({
  name: z.string().min(1, 'Name is required').max(100, 'Name must be 100 characters or less'),
})

export type CreateBrandInput = z.infer<typeof createBrandSchema>

// Brand update schema (admin only)
export const updateBrandSchema = z.object({
  name: z.string().min(1, 'Name is required').max(100).optional(),
  isActive: z.boolean().optional(),
})

export type UpdateBrandInput = z.infer<typeof updateBrandSchema>

// Brand list query schema
export const brandListQuerySchema = z.object({
  page: z.coerce.number().int().positive().default(1),
  pageSize: z.coerce.number().int().positive().max(100).default(50),
  search: z.string().optional(),
  isActive: z
    .string()
    .transform((val) => val === 'true')
    .optional(),
  sortBy: z.enum(['name', 'createdAt']).default('name'),
  sortOrder: z.enum(['asc', 'desc']).default('asc'),
})

export type BrandListQuery = z.infer<typeof brandListQuerySchema>

// Brand response type (what API returns)
export interface BrandResponse {
  id: string
  name: string
  isActive: boolean
  componentCount: number
  skuCount: number
  createdAt: string
  updatedAt: string
}
```

**Validation commands**:
```bash
npx tsc --noEmit
```

**Completion Criteria**:
- [ ] File created with all schemas and types
- [ ] TypeScript compiles without errors

## Phase 2: API Routes Layer
### Subtask 2.1: Create Brand List/Create API Route
**File**: `/home/pbrown/SkuInventory/src/app/api/brands/route.ts`
**Pattern**: Follow `/home/pbrown/SkuInventory/src/app/api/locations/route.ts` (lines 1-183)
**Instructions**:
1. Create GET handler for listing brands:
   - Admin-only access check
   - Scope by `session.user.selectedCompanyId`
   - Support pagination, search, isActive filter, sorting
   - Include `_count` for components and skus
2. Create POST handler for creating brands:
   - Admin-only access check
   - Validate body with `createBrandSchema`
   - Check unique constraint (companyId + name)
   - Create brand with `companyId` from session

**Key differences from Location route**:
- No `type` field (brands only have name)
- No `isDefault` field
- Include component/SKU counts in response

**Validation commands**:
```bash
npx tsc --noEmit
npm run build
```

**Completion Criteria**:
- [ ] GET returns paginated brands for selected company
- [ ] POST creates brand scoped to selected company
- [ ] Admin-only access enforced
- [ ] Duplicate name check works

### Subtask 2.2: Create Brand Detail/Update/Delete API Route
**File**: `/home/pbrown/SkuInventory/src/app/api/brands/[id]/route.ts`
**Pattern**: Follow `/home/pbrown/SkuInventory/src/app/api/locations/[id]/route.ts` (lines 1-233)
**Instructions**:
1. Create GET handler:
   - Admin-only access
   - Fetch brand by ID scoped to selectedCompanyId
   - Include counts for components and SKUs
2. Create PATCH handler:
   - Admin-only access
   - Validate body with `updateBrandSchema`
   - Check name uniqueness if changed
   - Prevent deactivating brand with active components/SKUs (warning only)
3. Create DELETE handler:
   - Admin-only access
   - Soft delete via `isActive: false`
   - Check for associated components/SKUs and warn

**Note**: Use `{ params }: { params: Promise<{ id: string }> }` signature for Next.js 14

**Validation commands**:
```bash
npx tsc --noEmit
npm run build
```

**Completion Criteria**:
- [ ] GET returns brand details
- [ ] PATCH updates brand name and isActive
- [ ] DELETE soft-deletes brand
- [ ] Company scoping enforced

## Phase 3: Frontend Components Layer
### Subtask 3.1: Create BrandTable Component
**File**: `/home/pbrown/SkuInventory/src/components/features/BrandTable.tsx`
**Pattern**: Follow `/home/pbrown/SkuInventory/src/components/features/LocationTable.tsx` (lines 1-251)
**Instructions**:
1. Create `BrandTableProps` interface with brands array and onRefresh callback
2. Create table with columns: Name, Status (Active/Inactive badge), Components, SKUs, Actions
3. Add dropdown menu with: Edit link, Toggle Active, Delete
4. Add confirmation dialog for delete action
5. Handle toggle active via PATCH to `/api/brands/[id]`
6. Handle delete via DELETE to `/api/brands/[id]`

**Differences from LocationTable**:
- No Type column (brands don't have types)
- No Default badge
- Add componentCount and skuCount columns
- Simpler delete logic (just warn about associated data)

**Validation commands**:
```bash
npx tsc --noEmit
npm run build
```

**Completion Criteria**:
- [ ] Table displays brand list with all columns
- [ ] Toggle active works
- [ ] Delete with confirmation works
- [ ] Edit link navigates to edit page

### Subtask 3.2: Create BrandForm Component
**File**: `/home/pbrown/SkuInventory/src/components/features/BrandForm.tsx`
**Pattern**: Follow `/home/pbrown/SkuInventory/src/components/features/LocationForm.tsx` (lines 1-220)
**Instructions**:
1. Create `BrandFormProps` interface: optional brand prop, optional onSuccess callback
2. Create form with fields:
   - Name (required input)
   - isActive checkbox (only in edit mode)
3. Handle create via POST to `/api/brands`
4. Handle update via PATCH to `/api/brands/[id]`
5. Redirect to `/settings/brands` on success

**Differences from LocationForm**:
- No Type dropdown
- No isDefault checkbox
- No notes textarea
- Much simpler form

**Validation commands**:
```bash
npx tsc --noEmit
npm run build
```

**Completion Criteria**:
- [ ] Form renders with name field
- [ ] Create mode works (POST)
- [ ] Edit mode works (PATCH)
- [ ] Error handling displays messages

## Phase 4: Frontend Pages Layer
### Subtask 4.1: Create Brands List Page
**File**: `/home/pbrown/SkuInventory/src/app/(dashboard)/settings/brands/page.tsx`
**Pattern**: Follow `/home/pbrown/SkuInventory/src/app/(dashboard)/settings/locations/page.tsx` (lines 1-135)
**Instructions**:
1. Create page with header: "Brand Management" title, "Add Brand" button
2. Add search input and status filter (Active/Inactive/All)
3. Fetch brands from `/api/brands` with filters
4. Display loading, error, and table states
5. Use BrandTable component for display

**Icon**: Use `Tag` from lucide-react (consistent with BrandSelector)

**Validation commands**:
```bash
npx tsc --noEmit
npm run build
```

**Completion Criteria**:
- [ ] Page renders with header and filters
- [ ] Data fetches from API
- [ ] Search and filter work
- [ ] Table displays brands

### Subtask 4.2: Create New Brand Page
**File**: `/home/pbrown/SkuInventory/src/app/(dashboard)/settings/brands/new/page.tsx`
**Pattern**: Follow `/home/pbrown/SkuInventory/src/app/(dashboard)/settings/locations/new/page.tsx` (lines 1-27)
**Instructions**:
1. Create page with back button to `/settings/brands`
2. Display "Create Brand" heading
3. Render BrandForm component

**Validation commands**:
```bash
npx tsc --noEmit
npm run build
```

**Completion Criteria**:
- [ ] Page renders with form
- [ ] Back button works
- [ ] Form submission works

### Subtask 4.3: Create Edit Brand Page
**File**: `/home/pbrown/SkuInventory/src/app/(dashboard)/settings/brands/[id]/edit/page.tsx`
**Pattern**: Follow `/home/pbrown/SkuInventory/src/app/(dashboard)/settings/locations/[id]/edit/page.tsx` (lines 1-89)
**Instructions**:
1. Create page that fetches brand by ID from URL params
2. Show loading state while fetching
3. Show error state if brand not found
4. Render BrandForm with brand data

**Validation commands**:
```bash
npx tsc --noEmit
npm run build
```

**Completion Criteria**:
- [ ] Page fetches brand data
- [ ] Loading state displays
- [ ] Form pre-populated with brand data
- [ ] Edit submission works

## Phase 5: Navigation Update
### Subtask 5.1: Add Brands to Dashboard Navigation
**File**: `/home/pbrown/SkuInventory/src/app/(dashboard)/layout.tsx`
**Pattern**: Follow existing navigation items (lines 33-47)
**Instructions**:
1. Import `Tag` icon from lucide-react (line 26 area)
2. Add navigation item after Locations:
   ```typescript
   { name: 'Brands', href: '/settings/brands', icon: Tag, adminOnly: true },
   ```

**Validation commands**:
```bash
npx tsc --noEmit
npm run build
```

**Completion Criteria**:
- [ ] Brands link appears in sidebar for admins
- [ ] Link navigates to brands page

## Phase 6: Final Validation
### Subtask 6.1: Build and Type Check
**Instructions**:
1. Run full build
2. Run type check
3. Test lint

**Validation commands**:
```bash
npm run build
npx tsc --noEmit
npm run lint
```

**Completion Criteria**:
- [ ] Build passes without errors
- [ ] TypeScript passes without errors
- [ ] Lint passes without errors

---

## Summary of Deliverables
**Files Created**: 9
- Types: `src/types/brand.ts`
- API Routes: `src/app/api/brands/route.ts`, `src/app/api/brands/[id]/route.ts`
- Components: `src/components/features/BrandTable.tsx`, `src/components/features/BrandForm.tsx`
- Pages: `src/app/(dashboard)/settings/brands/page.tsx`, `src/app/(dashboard)/settings/brands/new/page.tsx`, `src/app/(dashboard)/settings/brands/[id]/edit/page.tsx`
- Directories: `src/app/(dashboard)/settings/brands/`, `src/app/(dashboard)/settings/brands/[id]/edit/`, `src/app/(dashboard)/settings/brands/new/`

**Files Modified**: 1
- `src/app/(dashboard)/layout.tsx` (add nav item)

## Handoff to Build Agent
1. Execute subtasks in exact order (Types -> API -> Components -> Pages -> Navigation -> Validation)
2. Complete each phase fully before moving to next
3. Test completion criteria before next subtask
4. Follow reference patterns exactly
5. Use absolute file paths as specified

## Test Strategy Note
- Manual testing recommended after build:
  1. Login as admin
  2. Navigate to Settings > Brands
  3. Create a brand
  4. Edit the brand
  5. Deactivate the brand
  6. Verify brand selector updates

## Session Refresh Consideration
Note: When brands are created/edited/deleted, the session's brand list may become stale. For MVP, users can refresh the page or switch companies to reload brands. Future enhancement could add session refresh after brand CRUD operations.

## Performance Metrics
| Phase | Estimated Duration |
|-------|----------|
| Phase 1: Types | 15m |
| Phase 2: API Routes | 45m |
| Phase 3: Components | 60m |
| Phase 4: Pages | 45m |
| Phase 5: Navigation | 10m |
| Phase 6: Validation | 15m |
| **Total** | **~3.5h coding + testing** |
