# Implementation Plan
**Generated**: 2025-12-02 18:35 UTC
**Task ID**: Issue #16 - Add Build Version Footer with Auto-increment via Pre-commit Hook
**Estimated Build Time**: 2.5 hours
**Complexity**: Low

## Executive Summary
Add a version footer to all dashboard pages displaying "Build 0.5.X" with human-readable timestamp. Implement automatic patch version increment via pre-commit hook using husky. The version data will be stored in a JSON file at the project root, auto-incremented by a Node.js script before each commit.

## Key Decisions Made

### Decision 1: Version File Format
**Choice**: JSON (`version.json`) with TypeScript import

**Rationale**:
- `tsconfig.json` already has `"resolveJsonModule": true` enabled (line 11)
- `"esModuleInterop": true` is also enabled (line 8)
- No configuration changes needed - JSON imports work out of the box
- Simpler for script manipulation than TypeScript module

### Decision 2: Footer Placement
**Choice**: Inside dashboard layout only

**Rationale**: Issue specifies "all dashboard pages" - login page doesn't need version display.

### Decision 3: Husky Version
**Choice**: husky@9.1.7 (latest stable v9)

**Rationale**: Modern API, simpler configuration, well-documented.

---

## Phase 0: No Code Untangling Required
Scout report confirmed this is a straightforward additive feature with no complex existing code to understand.

---

## Phase 1: Infrastructure Setup

### Subtask 1.1: Create version.json
**File**: `/home/pbrown/SkuInventory/version.json`
**Pattern**: Standard JSON structure
**Instructions**:
Create the version data file with initial version 0.5.1:

```json
{
  "version": "0.5.1",
  "buildTimestamp": "2025-12-02T18:00:00.000Z"
}
```

**Completion Criteria**:
- [ ] File exists at project root
- [ ] Valid JSON format
- [ ] Version set to "0.5.1"
- [ ] buildTimestamp is valid ISO string

### Subtask 1.2: Install husky and Update package.json
**File**: `/home/pbrown/SkuInventory/package.json`
**Pattern**: Follow existing devDependencies structure
**Instructions**:

1. Add husky to devDependencies:
```json
"husky": "^9.1.7"
```

2. Add prepare script to scripts section (after "db:studio"):
```json
"prepare": "husky"
```

**Current scripts section ends at line 16-17 with:**
```json
    "db:studio": "prisma studio"
  },
```

**Should become:**
```json
    "db:studio": "prisma studio",
    "prepare": "husky"
  },
```

**Current devDependencies ends with:**
```json
    "tsx": "^4.21.0"
  }
```

**Add before the closing brace:**
```json
    "tsx": "^4.21.0",
    "husky": "^9.1.7"
  }
```

**Completion Criteria**:
- [ ] husky added to devDependencies
- [ ] prepare script added
- [ ] package.json is valid JSON
- [ ] `npm install` completes without errors

### Subtask 1.3: Initialize husky
**Command**: Run after npm install
```bash
cd /home/pbrown/SkuInventory && npm install && npx husky init
```

**Expected Result**: Creates `.husky/` directory with basic structure

**Completion Criteria**:
- [ ] `.husky/` directory exists
- [ ] `.husky/pre-commit` file exists (may have default content)

---

## Phase 2: Version Increment Script

### Subtask 2.1: Create increment-version.js
**File**: `/home/pbrown/SkuInventory/scripts/increment-version.js`
**Pattern**: Follow Node.js script conventions from `scripts/seed-inventory.ts` (synchronous operations for git hook)
**Instructions**:

Create the script with the following content:

```javascript
#!/usr/bin/env node
/**
 * Auto-increment patch version and update timestamp before each commit.
 * Called by .husky/pre-commit hook.
 *
 * Usage: node scripts/increment-version.js
 */

const fs = require('fs');
const path = require('path');
const { execSync } = require('child_process');

const VERSION_FILE = path.join(__dirname, '..', 'version.json');

function main() {
  // Read current version
  let versionData;
  try {
    const content = fs.readFileSync(VERSION_FILE, 'utf8');
    versionData = JSON.parse(content);
  } catch (error) {
    // Create default if missing
    console.log('version.json not found, creating with default 0.5.0');
    versionData = { version: '0.5.0', buildTimestamp: new Date().toISOString() };
  }

  // Parse semver and increment patch
  const parts = versionData.version.split('.');
  if (parts.length !== 3) {
    console.error('Invalid version format. Expected x.y.z');
    process.exit(1);
  }

  const major = parseInt(parts[0], 10);
  const minor = parseInt(parts[1], 10);
  const patch = parseInt(parts[2], 10);

  if (isNaN(major) || isNaN(minor) || isNaN(patch)) {
    console.error('Invalid version numbers');
    process.exit(1);
  }

  // Increment patch version
  const newVersion = `${major}.${minor}.${patch + 1}`;
  const newTimestamp = new Date().toISOString();

  // Update version data
  versionData.version = newVersion;
  versionData.buildTimestamp = newTimestamp;

  // Write back
  fs.writeFileSync(VERSION_FILE, JSON.stringify(versionData, null, 2) + '\n', 'utf8');
  console.log(`Version bumped: ${major}.${minor}.${patch} -> ${newVersion}`);

  // Stage the updated file
  try {
    execSync('git add version.json', { cwd: path.join(__dirname, '..'), stdio: 'inherit' });
  } catch (error) {
    console.error('Failed to stage version.json');
    process.exit(1);
  }
}

main();
```

**Key Features**:
- Uses synchronous file operations (required for git hooks)
- Creates default version.json if missing
- Validates semver format
- Auto-stages version.json after update
- Exits with non-zero code on error (aborts commit)

**Completion Criteria**:
- [ ] File exists at `/home/pbrown/SkuInventory/scripts/increment-version.js`
- [ ] File is executable or callable via `node scripts/increment-version.js`
- [ ] Running script increments version in version.json
- [ ] Running script updates buildTimestamp
- [ ] Script stages version.json with git add

**Validation Command**:
```bash
cd /home/pbrown/SkuInventory && node scripts/increment-version.js && cat version.json
```

---

## Phase 3: Pre-commit Hook Configuration

### Subtask 3.1: Configure .husky/pre-commit
**File**: `/home/pbrown/SkuInventory/.husky/pre-commit`
**Pattern**: Husky v9 format (simple shell script without shebang wrapper)
**Instructions**:

Replace the content of `.husky/pre-commit` with:

```sh
node scripts/increment-version.js
```

**Note**: Husky v9 uses a simplified format. The file should contain just the command(s) to run, not the v4-style wrapper.

**Completion Criteria**:
- [ ] File exists at `/home/pbrown/SkuInventory/.husky/pre-commit`
- [ ] Contains call to increment-version.js
- [ ] Making a test commit increments the version

**Validation Command**:
```bash
cd /home/pbrown/SkuInventory && cat .husky/pre-commit
```

**Test Hook** (do NOT actually commit during Build):
```bash
# Dry run test - verify script runs without errors
cd /home/pbrown/SkuInventory && node scripts/increment-version.js
```

---

## Phase 4: Footer Component

### Subtask 4.1: Create BuildFooter.tsx
**File**: `/home/pbrown/SkuInventory/src/components/ui/BuildFooter.tsx`
**Pattern**: Follow shadcn/ui patterns from:
- `/home/pbrown/SkuInventory/src/components/ui/badge.tsx` (simple functional component)
- `/home/pbrown/SkuInventory/src/components/ui/card.tsx` (CardFooter styling with cn())

**Instructions**:

Create the component with the following content:

```tsx
import { cn } from '@/lib/utils'
import versionData from '../../../version.json'

interface BuildFooterProps {
  className?: string
}

function formatTimestamp(isoString: string): string {
  try {
    const date = new Date(isoString)
    return date.toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'short',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
    })
  } catch {
    return 'Unknown'
  }
}

export function BuildFooter({ className }: BuildFooterProps) {
  return (
    <footer
      className={cn(
        'border-t bg-muted/50 px-4 py-2 text-center text-xs text-muted-foreground',
        className
      )}
    >
      <span>Build {versionData.version}</span>
      <span className="mx-2">|</span>
      <span>{formatTimestamp(versionData.buildTimestamp)}</span>
    </footer>
  )
}
```

**Key Design Decisions**:
- Uses relative import for version.json (`../../../version.json`) - 3 levels up from components/ui/
- Simple functional component (no forwardRef needed - footer won't receive refs)
- Uses cn() utility for className merging (consistent with other ui components)
- Muted text color, small size (text-xs), centered
- Border-top to separate from content
- Subtle background (bg-muted/50)
- Human-readable timestamp format

**Completion Criteria**:
- [ ] File exists at `/home/pbrown/SkuInventory/src/components/ui/BuildFooter.tsx`
- [ ] TypeScript compiles without errors
- [ ] Component exports BuildFooter function
- [ ] Uses cn() utility from @/lib/utils
- [ ] Imports version.json correctly

**Validation Command**:
```bash
cd /home/pbrown/SkuInventory && npx tsc --noEmit
```

---

## Phase 5: Layout Integration

### Subtask 5.1: Update Dashboard Layout
**File**: `/home/pbrown/SkuInventory/src/app/(dashboard)/layout.tsx`
**Pattern**: Follow existing import and layout structure
**Current Structure** (lines 110-122):

```tsx
      {/* Main content */}
      <div className="lg:pl-64">
        {/* Mobile header */}
        <header className="sticky top-0 z-30 flex h-16 items-center gap-4 border-b bg-background px-4 lg:hidden">
          <Button variant="ghost" size="icon" onClick={() => setSidebarOpen(true)}>
            <Menu className="h-5 w-5" />
          </Button>
          <span className="font-semibold">Inventory Tracker</span>
        </header>

        <main className="p-4 lg:p-8">{children}</main>
      </div>
```

**Instructions**:

1. Add import at the top of the file (after line 7, after Button import):
```tsx
import { BuildFooter } from '@/components/ui/BuildFooter'
```

2. Modify the main content structure (around line 111-121):

**Change from**:
```tsx
      {/* Main content */}
      <div className="lg:pl-64">
        {/* Mobile header */}
        <header className="sticky top-0 z-30 flex h-16 items-center gap-4 border-b bg-background px-4 lg:hidden">
          <Button variant="ghost" size="icon" onClick={() => setSidebarOpen(true)}>
            <Menu className="h-5 w-5" />
          </Button>
          <span className="font-semibold">Inventory Tracker</span>
        </header>

        <main className="p-4 lg:p-8">{children}</main>
      </div>
```

**Change to**:
```tsx
      {/* Main content */}
      <div className="lg:pl-64 flex flex-col min-h-screen">
        {/* Mobile header */}
        <header className="sticky top-0 z-30 flex h-16 items-center gap-4 border-b bg-background px-4 lg:hidden">
          <Button variant="ghost" size="icon" onClick={() => setSidebarOpen(true)}>
            <Menu className="h-5 w-5" />
          </Button>
          <span className="font-semibold">Inventory Tracker</span>
        </header>

        <main className="flex-1 p-4 lg:p-8">{children}</main>
        <BuildFooter />
      </div>
```

**Key Changes**:
- Add `flex flex-col min-h-screen` to outer div (enables footer-at-bottom layout)
- Add `flex-1` to main element (pushes footer to bottom)
- Add `<BuildFooter />` after main element

**Completion Criteria**:
- [ ] BuildFooter imported at top of file
- [ ] Outer div has flex column layout classes
- [ ] Main has flex-1 class
- [ ] BuildFooter rendered after main element
- [ ] TypeScript compiles without errors
- [ ] Build succeeds without errors

**Validation Commands**:
```bash
cd /home/pbrown/SkuInventory && npx tsc --noEmit
cd /home/pbrown/SkuInventory && npm run build
```

---

## Phase 6: Testing & Verification

### Subtask 6.1: Verify TypeScript Compilation
**Command**:
```bash
cd /home/pbrown/SkuInventory && npx tsc --noEmit
```

**Expected Result**: No errors

**Completion Criteria**:
- [ ] TypeScript compiles without errors

### Subtask 6.2: Verify Build Succeeds
**Command**:
```bash
cd /home/pbrown/SkuInventory && npm run build
```

**Expected Result**: Build completes (note: pre-existing error in `/api/export/transactions` may appear - this is unrelated to this feature)

**Completion Criteria**:
- [ ] Build completes
- [ ] No new errors introduced

### Subtask 6.3: Verify Lint Passes
**Command**:
```bash
cd /home/pbrown/SkuInventory && npm run lint
```

**Expected Result**: No new lint errors

**Completion Criteria**:
- [ ] Lint passes

### Subtask 6.4: Verify Version Increment Script
**Command**:
```bash
cd /home/pbrown/SkuInventory && node scripts/increment-version.js && cat version.json
```

**Expected Result**: Version incremented, timestamp updated

**Completion Criteria**:
- [ ] Script runs without errors
- [ ] version.json shows incremented patch version
- [ ] buildTimestamp is updated

### Subtask 6.5: Visual Verification
**Instructions**:
1. Start development server: `npm run dev` (note: runs on internal port, access via https://172.16.20.50:4543)
2. Navigate to any dashboard page
3. Verify footer is visible at bottom of page
4. Verify footer shows "Build 0.5.X" format
5. Verify timestamp is human-readable

**Completion Criteria**:
- [ ] Footer visible on dashboard pages
- [ ] Version format correct
- [ ] Timestamp readable
- [ ] Footer doesn't interfere with page content

---

## Summary of Deliverables

**Files Created (4)**:
| File | Purpose |
|------|---------|
| `/home/pbrown/SkuInventory/version.json` | Version data storage |
| `/home/pbrown/SkuInventory/scripts/increment-version.js` | Auto-increment script |
| `/home/pbrown/SkuInventory/.husky/pre-commit` | Git hook configuration |
| `/home/pbrown/SkuInventory/src/components/ui/BuildFooter.tsx` | Footer component |

**Files Modified (1)**:
| File | Changes |
|------|---------|
| `/home/pbrown/SkuInventory/package.json` | Add husky dependency + prepare script |
| `/home/pbrown/SkuInventory/src/app/(dashboard)/layout.tsx` | Add BuildFooter import and render |

**Files NOT Modified** (Scout initially suggested, but verified not needed):
| File | Reason |
|------|--------|
| `/home/pbrown/SkuInventory/tsconfig.json` | Already has `resolveJsonModule: true` |

---

## Handoff to Build Agent

### Execution Order
1. Execute subtasks in exact order (Phase 1 -> Phase 2 -> Phase 3 -> Phase 4 -> Phase 5 -> Phase 6)
2. Run validation commands after each phase
3. Do NOT proceed if validation fails - fix issues first
4. Follow code snippets exactly as provided

### Critical Notes
- **Port Convention**: App runs on port 4543 (HTTPS via nginx)
- **Code Quality**: No errors or warnings allowed - fix before moving on
- **tsconfig.json**: DO NOT modify - JSON imports already work
- **Husky Version**: Use 9.1.7 specifically, not older versions
- **Testing Commits**: Do NOT make actual git commits during build - just verify the script works

### Reference Patterns
- Component pattern: `/home/pbrown/SkuInventory/src/components/ui/badge.tsx`
- cn() utility: `/home/pbrown/SkuInventory/src/lib/utils.ts`
- Layout structure: `/home/pbrown/SkuInventory/src/app/(dashboard)/layout.tsx`
- Script pattern: `/home/pbrown/SkuInventory/scripts/seed-inventory.ts`

---

## Performance Metrics

| Phase | Duration |
|-------|----------|
| Scout Review | 3m |
| Pattern Research | 5m |
| Schema Verification | 2m (N/A - no DB changes) |
| Plan Writing | 15m |
| **Total** | **25m** |

---

**Plan Generated**: 2025-12-02
**Issue**: #16
**Status**: Ready for Build Agent
**Confidence**: High (95%)
