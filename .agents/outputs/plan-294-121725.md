# Implementation Plan
**Generated**: 2025-12-17T12:45:00Z
**Generated By**: Scout-and-Plan Agent (combined workflow)
**Task ID**: GitHub Issue #294
**Estimated Build Time**: 2-3 hours
**Complexity**: Low

## Investigation Summary

### Request Analysis
**Type**: Enhancement
**Source**: GitHub Issue #294
**Priority**: Medium

### Task Classification
**Category**: NEW_FEATURE
**Test Strategy**: TARGETED
**Suggested Filter**: `--filter="notification"` or None (manual verification)

### Issue Validation
**Status**: Valid
**Recent Changes**: `b9c811a feat(002): implement Amazon Ads & Shopify data ingestion foundation` - Added notification infrastructure including notification-banner.tsx and notifications service

### Current State Assessment

**Existing Components**:
- `src/components/notifications/notification-banner.tsx` - Client component displaying notifications popover in header
- `src/services/notifications.ts` - Service layer for creating/managing notifications
- `src/app/api/notifications/route.ts` - GET notifications, POST mark-all-read
- `src/app/api/notifications/[id]/route.ts` - PATCH to mark read/dismiss

**Database**:
- `Notification` model exists in Prisma schema with `relatedType` and `relatedId` fields
- Supported values: `relatedType: 'sync_log' | 'credential'`

**API Routes**:
- Notifications API already returns `relatedType` and `relatedId` fields
- No new endpoints needed

**Types**:
- Interface in notification-banner.tsx already includes `relatedType?: string` and `relatedId?: string`

### Dependencies & Blockers
1. **None identified** - All infrastructure exists

**Can Proceed?**: YES

### Complexity Assessment
**Complexity**: Simple
**Effort**: 2-3 hours
**Risk**: Low

### Patterns Identified

**Primary**: `src/components/features/ExpiryWarningBanner.tsx`
- Uses `Link` from `next/link` for navigation
- Pattern: `<Link href="/lots?status=expiring_soon">` for deep links
- Line 60, 126, 132: Examples of Link usage with routes

**Secondary**: `src/components/integrations/sync-history.tsx`
- Status badge coloring patterns (lines 69-81)
- Uses `Badge` component with custom className for color variants

**Tertiary**: `src/components/ui/badge.tsx`
- Has existing variants: `success`, `warning`, `critical`
- Can be used directly for severity styling

### Ripple Effect Analysis
**Files Identified**: 1 (notification-banner.tsx only)
- No callers need changes - component is self-contained
- API already returns necessary fields
- Service layer already supports relatedType/relatedId

**Deep Link Route Mapping**:
| relatedType | Route | Notes |
|-------------|-------|-------|
| `sync_log` | `/integrations` | Integrations page shows SyncHistory component |
| `credential` | `/integrations` | Credentials managed on integrations page |

---

## Executive Summary

Add deep link navigation and visual severity cues to the notification popover component. When users click on notifications that have a `relatedType` and `relatedId`, they will be navigated to the relevant page (integrations page for sync logs and credentials). Additionally, enhance the notification display with clearer severity styling based on notification type using existing Badge component variants.

---

## Phase 1: Add Deep Link Helper and Navigation

### Subtask 1.1: Add Link Import and Deep Link Helper Function
**File**: `/home/pbrown/SkuInventory/src/components/notifications/notification-banner.tsx`
**Pattern**: Follow `src/components/features/ExpiryWarningBanner.tsx` (line 3)
**Instructions**:
1. Add import for `Link` from `next/link`
2. Add import for `ExternalLink` from `lucide-react` (for link indicator icon)
3. Add helper function `getNotificationLink` that maps relatedType/relatedId to routes:

```typescript
// After existing imports, add:
import Link from 'next/link'
import { Bell, X, AlertCircle, CheckCircle, Info, AlertTriangle, ExternalLink } from 'lucide-react'

// Before the component, add helper function:
function getNotificationLink(relatedType?: string, relatedId?: string): string | null {
  if (!relatedType || !relatedId) return null

  switch (relatedType) {
    case 'sync_log':
      // Navigate to integrations page which shows sync history
      return '/integrations'
    case 'credential':
      // Navigate to integrations page where credentials are managed
      return '/integrations'
    default:
      return null
  }
}
```

**Completion Criteria**:
- [ ] Link and ExternalLink imports added
- [ ] `getNotificationLink` helper function added
- [ ] TypeScript compiles without errors: `npx tsc --noEmit`

### Subtask 1.2: Update Notification Item to Include Deep Link
**File**: `/home/pbrown/SkuInventory/src/components/notifications/notification-banner.tsx`
**Pattern**: Follow `src/components/features/ExpiryWarningBanner.tsx` (lines 97-102)
**Instructions**:
1. In the notification map rendering (around lines 187-224), update to include link functionality
2. Add link indicator next to title when a deep link is available
3. Make the notification title clickable when link exists
4. Close popover when navigating via link

Replace the notification title section (approximately lines 198-201):
```typescript
{/* OLD - title only */}
<p className={`text-sm font-medium ${!notification.isRead ? 'font-semibold' : ''}`}>
  {notification.title}
</p>

{/* NEW - title with optional link */}
{(() => {
  const link = getNotificationLink(notification.relatedType, notification.relatedId)
  return link ? (
    <Link
      href={link}
      className={`text-sm font-medium hover:underline flex items-center gap-1 ${!notification.isRead ? 'font-semibold' : ''}`}
      onClick={(e) => {
        e.stopPropagation()
        setOpen(false)
      }}
    >
      {notification.title}
      <ExternalLink className="h-3 w-3 text-muted-foreground" />
    </Link>
  ) : (
    <p className={`text-sm font-medium ${!notification.isRead ? 'font-semibold' : ''}`}>
      {notification.title}
    </p>
  )
})()}
```

**Completion Criteria**:
- [ ] Notification title renders as Link when relatedType/relatedId exist
- [ ] ExternalLink icon appears next to linked titles
- [ ] Clicking link closes the popover
- [ ] Non-linked notifications still display as plain text
- [ ] TypeScript compiles: `npx tsc --noEmit`

---

## Phase 2: Add Severity Styling

### Subtask 2.1: Add Severity Background Styling to Notification Items
**File**: `/home/pbrown/SkuInventory/src/components/notifications/notification-banner.tsx`
**Pattern**: Follow `src/components/integrations/sync-history.tsx` (lines 69-81) for status-based styling
**Instructions**:
1. Create a helper function to get severity-based background colors
2. Update the notification item container to apply severity styling

Add helper function after `getNotificationLink`:
```typescript
function getSeverityStyles(type: Notification['type']): string {
  switch (type) {
    case 'sync_failure':
      return 'border-l-4 border-l-red-500 bg-red-50/50 dark:bg-red-950/20'
    case 'alert':
      return 'border-l-4 border-l-orange-500 bg-orange-50/50 dark:bg-orange-950/20'
    case 'warning':
      return 'border-l-4 border-l-yellow-500 bg-yellow-50/50 dark:bg-yellow-950/20'
    case 'sync_success':
      return 'border-l-4 border-l-green-500 bg-green-50/50 dark:bg-green-950/20'
    case 'info':
    default:
      return 'border-l-4 border-l-blue-500 bg-blue-50/50 dark:bg-blue-950/20'
  }
}
```

**Completion Criteria**:
- [ ] `getSeverityStyles` helper function added
- [ ] Function handles all notification types
- [ ] Dark mode variants included
- [ ] TypeScript compiles: `npx tsc --noEmit`

### Subtask 2.2: Apply Severity Styles to Notification Container
**File**: `/home/pbrown/SkuInventory/src/components/notifications/notification-banner.tsx`
**Pattern**: Custom styling based on notification type
**Instructions**:
1. Update the notification item div className (around line 188-193) to include severity styles

Replace the notification container className:
```typescript
{/* OLD className */}
className={`p-3 border-b last:border-b-0 hover:bg-muted/50 transition-colors ${
  !notification.isRead ? 'bg-muted/30' : ''
}`}

{/* NEW className with severity styling */}
className={`p-3 border-b last:border-b-0 hover:bg-muted/50 transition-colors ${
  getSeverityStyles(notification.type)
} ${!notification.isRead ? 'ring-1 ring-inset ring-primary/20' : 'opacity-75'}`}
```

**Completion Criteria**:
- [ ] Severity background colors applied based on notification type
- [ ] sync_failure shows red accent
- [ ] alert shows orange accent
- [ ] warning shows yellow accent
- [ ] sync_success shows green accent
- [ ] info shows blue accent
- [ ] Unread notifications have subtle ring indicator
- [ ] Read notifications have reduced opacity
- [ ] TypeScript compiles: `npx tsc --noEmit`

---

## Phase 3: Verification

### Subtask 3.1: Build Verification
**Instructions**:
1. Run full build to ensure no errors:
   ```bash
   npm run build
   ```
2. Run TypeScript check:
   ```bash
   npx tsc --noEmit
   ```
3. Run lint:
   ```bash
   npm run lint
   ```

**Completion Criteria**:
- [ ] `npm run build` completes without errors
- [ ] `npx tsc --noEmit` completes without errors
- [ ] `npm run lint` completes without errors or warnings

### Subtask 3.2: Manual Visual Verification (Test Environment)
**Instructions**:
1. Access test environment: http://172.16.20.50:2345
2. Login and navigate to dashboard
3. If notifications exist, verify:
   - Severity colors are visible on notification items
   - Deep links appear for notifications with relatedType/relatedId
   - Clicking deep link navigates to integrations page and closes popover
4. If no notifications exist, verify the component renders without errors

**Completion Criteria**:
- [ ] Notification popover opens correctly
- [ ] Severity colors differentiate notification types
- [ ] Deep links work (if notifications with relatedType exist)
- [ ] Existing functionality (mark read, dismiss) still works

---

## Summary of Deliverables

**Files Created**: 0
**Files Modified**: 1

| File | Changes |
|------|---------|
| `src/components/notifications/notification-banner.tsx` | Add deep link navigation, severity styling helpers, updated UI |

## Handoff to Build Agent

1. Execute subtasks in exact order (1.1, 1.2, 2.1, 2.2, 3.1, 3.2)
2. Each subtask modifies the same file - ensure edits don't conflict
3. Run TypeScript check after each subtask
4. Follow reference patterns exactly from ExpiryWarningBanner.tsx and sync-history.tsx

## Test Strategy Note

- Manual visual verification on test environment (http://172.16.20.50:2345)
- No automated tests required for this UI enhancement
- Verify existing mark-read/dismiss functionality still works after changes

## Acceptance Criteria Summary

From Issue #294:
- [x] Plan includes: Each notification links to its related record when possible
- [x] Plan includes: Severity styling differentiates alert/warning/success/info
- [x] Plan includes: Existing unread/dismiss behavior verification

## Performance Metrics

| Phase | Duration |
|-------|----------|
| Investigation | 15m |
| Validation | 5m |
| Planning | 10m |
| **Total** | **30m** |
