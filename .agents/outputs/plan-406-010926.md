# Quick Fix Plan

**Issue**: #406 - Apply fraction input support to QuickEntryForm and FinishedGoodsReceiptDialog cost fields
**Generated**: 2026-01-09
**Generated By**: Scout-and-Plan Agent (combined workflow)
**Tier**: 1 (Quick Fix)
**Type**: Enhancement
**Est. Time**: 1-2 hours

## Investigation Summary

### Request Analysis
**Type**: Enhancement
**Source**: GitHub Issue #406
**Priority**: Low

### Task Classification
**Category**: ENHANCEMENT
**Test Strategy**: FAST_PATH
**Suggested Filter**: None

### Issue Validation
**Status**: Valid
**Related Issue**: #394 (closed) - Original ComponentForm fraction fix

### Current State Assessment
- The `parseFractionOrNumber()` utility already exists in `src/lib/utils.ts:85`
- ComponentForm.tsx was fixed in #394 - uses `type="text"` and `parseFractionOrNumber()`
- QuickEntryForm.tsx still uses `type="number"` for `receipt-cost` field (line 664)
- FinishedGoodsReceiptDialog.tsx still uses `type="number"` for `fg-rcpt-cost` field (line 238)

### Pattern Scan Results
**ADDITIONAL FILE DISCOVERED**: `ReceiptDialog.tsx` also has the same pattern issue at line 259 (costPerUnit field).

Since the issue specifically mentions only 2 files and this is a Tier 1 fix, I recommend:
- Fix the 2 files mentioned in this issue
- Create a follow-up issue for ReceiptDialog.tsx

**Files to Fix in This Issue**: 2
**Files with Same Pattern (for follow-up issue)**: 1 (ReceiptDialog.tsx)

---

## The Fix

Both QuickEntryForm.tsx and FinishedGoodsReceiptDialog.tsx have cost input fields that use `type="number"` which prevents fraction input (e.g., "1/45"). The fix follows the pattern established in #394 for ComponentForm:
1. Change `type="number"` to `type="text"` for cost inputs
2. Add placeholder text showing fraction example
3. Use `parseFractionOrNumber()` when parsing the value for submission

## Changes Required

### File 1: QuickEntryForm.tsx

| Line | Current | Change |
|------|---------|--------|
| 21 | `import { cn, toLocalDateString } from '@/lib/utils'` | Add `parseFractionOrNumber` to import |
| 664 | `type="number"` | Change to `type="text"` |
| 665-666 | `step="0.0001"` and `min="0"` | Remove both attributes |
| 668 | `placeholder="Leave blank to use component default"` | Update to `placeholder="e.g., 0.02, 1/45 (blank = default)"` |
| 329 | `costPerUnit: inboundFormData.costPerUnit ? parseFloat(inboundFormData.costPerUnit) : undefined` | Change `parseFloat` to `parseFractionOrNumber` |
| 376 | `costPerUnit: inboundFormData.costPerUnit ? parseFloat(inboundFormData.costPerUnit) : undefined` | Change `parseFloat` to `parseFractionOrNumber` |

**Exact changes:**

**Import (line 21)**:
```typescript
// FROM:
import { cn, toLocalDateString } from '@/lib/utils'
// TO:
import { cn, toLocalDateString, parseFractionOrNumber } from '@/lib/utils'
```

**Input field (lines 662-671)**:
```tsx
// FROM:
<Input
  id="receipt-cost"
  type="number"
  step="0.0001"
  min="0"
  className="col-span-3"
  placeholder="Leave blank to use component default"
  value={inboundFormData.costPerUnit}
  onChange={(e) => setInboundFormData((prev) => ({ ...prev, costPerUnit: e.target.value }))}
/>

// TO:
<Input
  id="receipt-cost"
  type="text"
  className="col-span-3"
  placeholder="e.g., 0.02, 1/45 (blank = default)"
  value={inboundFormData.costPerUnit}
  onChange={(e) => setInboundFormData((prev) => ({ ...prev, costPerUnit: e.target.value }))}
/>
```

**Payload parsing (line 329 in draft mode)**:
```typescript
// FROM:
costPerUnit: inboundFormData.costPerUnit ? parseFloat(inboundFormData.costPerUnit) : undefined,
// TO:
costPerUnit: inboundFormData.costPerUnit ? parseFractionOrNumber(inboundFormData.costPerUnit) ?? undefined : undefined,
```

**Payload parsing (line 376 in non-draft mode)**:
```typescript
// FROM:
costPerUnit: inboundFormData.costPerUnit ? parseFloat(inboundFormData.costPerUnit) : undefined,
// TO:
costPerUnit: inboundFormData.costPerUnit ? parseFractionOrNumber(inboundFormData.costPerUnit) ?? undefined : undefined,
```

---

### File 2: FinishedGoodsReceiptDialog.tsx

| Line | Current | Change |
|------|---------|--------|
| 22 | `import { toLocalDateString } from '@/lib/utils'` | Add `parseFractionOrNumber` to import |
| 238 | `type="number"` | Change to `type="text"` |
| 239-240 | `step="0.01"` and `min="0"` | Remove both attributes |
| 242 | `placeholder="Leave blank if not applicable"` | Update to `placeholder="e.g., 0.02, 1/45 (blank = N/A)"` |
| 98 | `costPerUnit: formData.costPerUnit ? parseFloat(formData.costPerUnit) : undefined` | Change `parseFloat` to `parseFractionOrNumber` |

**Exact changes:**

**Import (line 22)**:
```typescript
// FROM:
import { toLocalDateString } from '@/lib/utils'
// TO:
import { toLocalDateString, parseFractionOrNumber } from '@/lib/utils'
```

**Input field (lines 236-245)**:
```tsx
// FROM:
<Input
  id="fg-rcpt-cost"
  type="number"
  step="0.01"
  min="0"
  className="col-span-3"
  placeholder="Leave blank if not applicable"
  value={formData.costPerUnit}
  onChange={(e) => setFormData((prev) => ({ ...prev, costPerUnit: e.target.value }))}
/>

// TO:
<Input
  id="fg-rcpt-cost"
  type="text"
  className="col-span-3"
  placeholder="e.g., 0.02, 1/45 (blank = N/A)"
  value={formData.costPerUnit}
  onChange={(e) => setFormData((prev) => ({ ...prev, costPerUnit: e.target.value }))}
/>
```

**Payload parsing (line 98)**:
```typescript
// FROM:
costPerUnit: formData.costPerUnit ? parseFloat(formData.costPerUnit) : undefined,
// TO:
costPerUnit: formData.costPerUnit ? parseFractionOrNumber(formData.costPerUnit) ?? undefined : undefined,
```

---

## Validation

After making changes:

- [ ] `npx tsc --noEmit` passes (no TypeScript errors)
- [ ] `npm run build` passes
- [ ] `npm run lint` passes

## Manual Testing Checklist

- [ ] QuickEntryForm (Inbound): Enter "1/45" in Cost/Unit field - should be accepted and parsed correctly
- [ ] QuickEntryForm (Inbound): Enter "0.02" - should still work as decimal
- [ ] QuickEntryForm (Inbound): Leave blank - should use component default
- [ ] FinishedGoodsReceiptDialog: Enter "1/45" in Cost/Unit field - should be accepted
- [ ] FinishedGoodsReceiptDialog: Enter "0.02" - should still work as decimal
- [ ] FinishedGoodsReceiptDialog: Leave blank - should work without cost

## Files Summary

**Created**: 0
**Modified**: 2
- `src/components/features/QuickEntryForm.tsx` - import, input attributes, payload parsing (2 locations)
- `src/components/features/FinishedGoodsReceiptDialog.tsx` - import, input attributes, payload parsing (1 location)

## Follow-up Issue Recommended

**File**: `src/components/features/ReceiptDialog.tsx`
**Line**: 259 (costPerUnit input) and line 104 (parseFloat)
**Same Pattern**: Uses `type="number"` and `parseFloat()` instead of fraction support

**Suggested Action**: Create GitHub issue to apply same fix to ReceiptDialog.tsx for consistency.

---

## Pattern Reference

**Primary**: `src/components/features/ComponentForm.tsx:228-235` - The input field pattern
**Secondary**: `src/components/features/ComponentForm.tsx:97` - The parseFractionOrNumber usage in payload
