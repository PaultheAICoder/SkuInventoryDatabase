# Implementation Plan
**Generated**: 2025-12-31 07:15:00 UTC
**Generated By**: Scout-and-Plan Agent (combined workflow)
**Task ID**: GitHub Issue #341
**Estimated Build Time**: 1-2 hours
**Complexity**: Low

## Investigation Summary

### Request Analysis
**Type**: Feature
**Source**: GitHub Issue #341
**Priority**: Medium

### Task Classification
**Category**: REFACTORING
**Test Strategy**: FAST_PATH (smoke tests only)
**Suggested Filter**: None - this is a navigation refactoring with no test files to run

### Issue Validation
**Status**: Valid
**Recent Changes**: The dashboard layout was recently modified in several commits:
- `39f2e54` (Dec) - reorganized sidebar navigation for Shopify features
- `4d18454` - added Integrations navigation link
- The navigation structure is stable and well-defined

### Current State Assessment

**Existing Navigation Structure** (`/home/pbrown/SkuInventory/src/app/(dashboard)/layout.tsx`):

1. **Main Navigation** (lines 44-56): Top-level navigation items including:
   - Dashboard, Components, SKUs, Transactions, Lots
   - **Import** (currently at line 50) - Target for relocation
   - Analytics, Forecasts, Shopify, SKU Mappings, Amazon

2. **Settings Sub-Navigation** (lines 59-68): Expandable submenu with:
   - General, Users, Locations, Brands, Categories, Companies
   - Integrations, Docker Health

3. **Import Page**: Located at `/home/pbrown/SkuInventory/src/app/(dashboard)/import/page.tsx`
   - Handles component, SKU, initial inventory, and snapshot imports
   - Already checks for viewer role and blocks access appropriately

4. **API Routes**: Import API routes at `/home/pbrown/SkuInventory/src/app/api/import/`
   - No changes needed - API paths remain `/api/import/*`

5. **Middleware**: `/home/pbrown/SkuInventory/src/middleware.ts`
   - Import API routes already in `WRITE_RESTRICTED_API_ROUTES`
   - No changes needed

### Dependencies & Blockers
None identified. This is a self-contained navigation change.

**Can Proceed?**: YES

### Complexity Assessment
**Complexity**: Simple
**Effort**: 1-2 hours
**Risk**: Low

### Patterns Identified
**Primary**: Settings sub-navigation pattern (lines 59-68 of layout.tsx)
**Secondary**: Main navigation items (lines 44-56 of layout.tsx)

The existing `settingsNavigation` array provides the exact pattern to follow. Import needs to be:
1. Removed from `mainNavigation` array
2. Added to `settingsNavigation` array

### Ripple Effect Analysis
**Files Identified**: 1 (plus optional middleware consideration)

| File | Change Type | Reason |
|------|-------------|--------|
| `/home/pbrown/SkuInventory/src/app/(dashboard)/layout.tsx` | Modify | Move Import from mainNavigation to settingsNavigation |

**Note**: The Import page location (`/import`) is NOT changing, only the navigation menu placement. However, if we want consistency with other settings items (like `/settings/users`, `/settings/locations`), we could optionally move the page. The issue description says to move Import to a "sub-menu under Settings" but does not specify changing the URL path.

**Decision**: Keep the Import page at `/import` as the issue only requests navigation reorganization, not URL restructuring. Moving the page directory would be a separate concern requiring redirect handling.

---

## Executive Summary

This feature relocates the Import navigation item from the main sidebar navigation to the Settings sub-menu. The change involves:
1. Removing Import from `mainNavigation` array
2. Adding Import to `settingsNavigation` array
3. No URL changes, API changes, or page relocations required

This groups the Import function with other administrative settings, reducing main navigation clutter while maintaining functionality.

---

## Phase 1: Navigation Refactoring

### Subtask 1.1: Remove Import from Main Navigation

**File**: `/home/pbrown/SkuInventory/src/app/(dashboard)/layout.tsx`

**Pattern**: Existing navigation structure (lines 44-56)

**Instructions**:
1. Locate the `mainNavigation` array (line 44)
2. Remove the Import entry at line 50:
   ```typescript
   { name: 'Import', href: '/import', icon: Upload },
   ```

**Validation**:
```bash
npx tsc --noEmit
```

**Completion Criteria**:
- [ ] Import entry removed from `mainNavigation` array
- [ ] No TypeScript errors

### Subtask 1.2: Add Import to Settings Sub-Navigation

**File**: `/home/pbrown/SkuInventory/src/app/(dashboard)/layout.tsx`

**Pattern**: Existing `settingsNavigation` array (lines 59-68)

**Instructions**:
1. Locate the `settingsNavigation` array (line 59)
2. Add Import as a new entry. Place it logically (suggest after "General" or at the end before "Docker Health"):
   ```typescript
   { name: 'Import', href: '/import', icon: Upload },
   ```
3. The `Upload` icon is already imported at line 14

**Suggested placement** (after General at line 60):
```typescript
const settingsNavigation = [
  { name: 'General', href: '/settings', icon: Settings },
  { name: 'Import', href: '/import', icon: Upload },  // NEW
  { name: 'Users', href: '/settings/users', icon: Users },
  // ... rest of items
]
```

**Validation**:
```bash
npx tsc --noEmit
npm run build
```

**Completion Criteria**:
- [ ] Import entry added to `settingsNavigation` array
- [ ] Upload icon still imported (verify line 14)
- [ ] TypeScript compiles without errors
- [ ] Build succeeds

### Subtask 1.3: Verify Settings Auto-Expand for Import Path

**File**: `/home/pbrown/SkuInventory/src/app/(dashboard)/layout.tsx`

**Pattern**: Auto-expand logic at lines 81-88

**Instructions**:
1. Review the auto-expand logic in the `useEffect` hook (lines 81-88):
   ```typescript
   useEffect(() => {
     const isSettingsPath = settingsNavigation.some(
       (item) => pathname === item.href || pathname.startsWith(item.href + '/')
     )
     if (isSettingsPath) {
       setSettingsOpen(true)
     }
   }, [pathname])
   ```
2. Verify that when navigating to `/import`, the settings menu will auto-expand
3. Since Import's `href` is `/import`, the logic `pathname === item.href` will match when on the import page

**No code change needed** - the existing logic handles this automatically once Import is in `settingsNavigation`.

**Validation**:
```bash
# Manual verification after build:
# Navigate to /import and confirm Settings menu is expanded
```

**Completion Criteria**:
- [ ] Confirmed that auto-expand logic will work for `/import` path

---

## Phase 2: Build Verification

### Subtask 2.1: Full Build and Type Check

**File**: N/A (project-wide)

**Instructions**:
1. Run TypeScript type check
2. Run full build
3. Verify no errors or warnings

**Validation**:
```bash
npx tsc --noEmit
npm run build
npm run lint
```

**Completion Criteria**:
- [ ] TypeScript check passes
- [ ] Build completes successfully
- [ ] No lint errors

---

## Summary of Deliverables

**Files Created**: 0
**Files Modified**: 1
- `/home/pbrown/SkuInventory/src/app/(dashboard)/layout.tsx` - Navigation restructuring

## Handoff to Build Agent

1. Execute subtasks in exact order (1.1 -> 1.2 -> 1.3 -> 2.1)
2. The `Upload` icon import is already present - verify it remains
3. Test completion criteria before next subtask
4. No URL changes or page relocations needed

## Test Strategy Note

- **Type**: FAST_PATH
- No automated tests for navigation structure exist
- Manual verification recommended:
  1. Login as admin user
  2. Verify Import is NOT in main navigation
  3. Verify Import IS in Settings sub-menu
  4. Click Import - verify page loads correctly
  5. Navigate away and back - verify Settings menu auto-expands when on /import

## UI Acceptance Criteria

- [ ] Import item NOT visible in main sidebar navigation
- [ ] Import item visible under Settings sub-menu
- [ ] Import item visible on desktop (1024px+)
- [ ] Import item visible on tablet (768px-1023px)
- [ ] Import item visible on mobile (<768px) when sidebar is open
- [ ] Settings menu auto-expands when navigating to /import
- [ ] Import page functionality unchanged

## Performance Metrics

| Phase | Duration |
|-------|----------|
| Investigation | 8m |
| Validation | 2m |
| Planning | 5m |
| **Total** | **15m** |

---

## Code Reference

### Current mainNavigation Array (lines 44-56)
```typescript
const mainNavigation = [
  { name: 'Dashboard', href: '/', icon: LayoutDashboard },
  { name: 'Components', href: '/components', icon: Package },
  { name: 'SKUs', href: '/skus', icon: Boxes },
  { name: 'Transactions', href: '/transactions', icon: ArrowLeftRight },
  { name: 'Lots', href: '/lots', icon: Layers },
  { name: 'Import', href: '/import', icon: Upload },  // <-- REMOVE THIS
  { name: 'Analytics', href: '/analytics/defects', icon: BarChart3 },
  { name: 'Forecasts', href: '/forecasts', icon: TrendingDown },
  { name: 'Shopify', href: '/shopify/orders', icon: ShoppingCart, adminOnly: true },
  { name: 'SKU Mappings', href: '/shopify/mappings', icon: Link2, adminOnly: true },
  { name: 'Amazon', href: '/amazon', icon: Store, adminOnly: true },
]
```

### Current settingsNavigation Array (lines 59-68)
```typescript
const settingsNavigation = [
  { name: 'General', href: '/settings', icon: Settings },
  { name: 'Users', href: '/settings/users', icon: Users },
  { name: 'Locations', href: '/settings/locations', icon: MapPin },
  { name: 'Brands', href: '/settings/brands', icon: Tag },
  { name: 'Categories', href: '/settings/categories', icon: FolderTree },
  { name: 'Companies', href: '/settings/companies', icon: Building2 },
  { name: 'Integrations', href: '/integrations', icon: Plug },
  { name: 'Docker Health', href: '/admin/docker-health', icon: Activity },
]
```

### Target settingsNavigation Array (after change)
```typescript
const settingsNavigation = [
  { name: 'General', href: '/settings', icon: Settings },
  { name: 'Import', href: '/import', icon: Upload },  // <-- ADD THIS
  { name: 'Users', href: '/settings/users', icon: Users },
  { name: 'Locations', href: '/settings/locations', icon: MapPin },
  { name: 'Brands', href: '/settings/brands', icon: Tag },
  { name: 'Categories', href: '/settings/categories', icon: FolderTree },
  { name: 'Companies', href: '/settings/companies', icon: Building2 },
  { name: 'Integrations', href: '/integrations', icon: Plug },
  { name: 'Docker Health', href: '/admin/docker-health', icon: Activity },
]
```
